<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>–¢–µ—Å—Ç API</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #1e1e1e;
      color: #00ff00;
    }

    .test {
      margin: 10px 0;
      padding: 10px;
      background: #2d2d2d;
    }

    .success {
      color: #00ff00;
    }

    .error {
      color: #ff0000;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin: 10px 5px;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <h1>üîç –¢–µ—Å—Ç API - –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</h1>

  <button onclick="testAPI()">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
  <button onclick="location.reload()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
  <button onclick="openConsole()">üìã –û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å (F12)</button>

  <div id="results"></div>

  <script>
    function log(message, type = 'info') {
      const div = document.createElement('div');
      div.className = `test ${type}`;
      div.innerHTML = message;
      document.getElementById('results').appendChild(div);
      console.log(message);
    }

    function openConsole() {
      alert('–ù–∞–∂–º–∏—Ç–µ F12 –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ–Ω—Å–æ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞');
    }

    async function testAPI() {
      document.getElementById('results').innerHTML = '';

      log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
      log('üöÄ –ù–ê–ß–ê–õ–û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø', 'info');
      log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
      log('');

      // –¢–µ—Å—Ç 1: –¢–µ–∫—É—â–∏–π URL
      log(`üìç –¢–µ–∫—É—â–∏–π URL: ${window.location.href}`, 'info');
      log(`üìç –ü—Ä–æ—Ç–æ–∫–æ–ª: ${window.location.protocol}`, 'info');
      log('');

      if (window.location.protocol === 'file:') {
        log('‚ùå –û–®–ò–ë–ö–ê: –û—Ç–∫—Ä—ã—Ç–æ —á–µ—Ä–µ–∑ file:///', 'error');
        log('   –≠—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç! –ù—É–∂–µ–Ω HTTP —Å–µ—Ä–≤–µ—Ä', 'error');
        log('   –ó–∞–ø—É—Å—Ç–∏—Ç–µ start_manager.bat', 'error');
        log('');
        return;
      }

      // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API —Ñ–∞–π–ª–∞
      log('[1/3] –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ api.php...', 'info');
      try {
        const response = await fetch('api.php');
        log(`‚úÖ api.php –¥–æ—Å—Ç—É–ø–µ–Ω (HTTP ${response.status})`, 'success');
        log(`   Content-Type: ${response.headers.get('content-type')}`, 'info');
      } catch (error) {
        log(`‚ùå api.php –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${error.message}`, 'error');
        log('   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PHP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω', 'error');
        return;
      }
      log('');

      // –¢–µ—Å—Ç 3: –¢–µ—Å—Ç API endpoint - cache stats
      log('[2/3] –¢–µ—Å—Ç API: get_cache_stats...', 'info');
      try {
        const response = await fetch('api.php?action=get_cache_stats');

        log(`   HTTP —Å—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`, 'info');
        log(`   Content-Type: ${response.headers.get('content-type')}`, 'info');

        if (!response.ok) {
          const text = await response.text();
          log(`‚ùå –û—à–∏–±–∫–∞ HTTP ${response.status}`, 'error');
          log(`   –û—Ç–≤–µ—Ç: ${text.substring(0, 200)}`, 'error');
          return;
        }

        const data = await response.json();
        log(`‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç!`, 'success');
        log(`   –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(data, null, 2)}`, 'info');
      } catch (error) {
        log(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ: ${error.message}`, 'error');
        return;
      }
      log('');

      // –¢–µ—Å—Ç 4: –¢–µ—Å—Ç API endpoint - list groups
      log('[3/3] –¢–µ—Å—Ç API: list_groups...', 'info');
      try {
        const response = await fetch('api.php?action=list_groups');

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const groups = await response.json();
        log(`‚úÖ –°–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø –∑–∞–≥—Ä—É–∂–µ–Ω!`, 'success');
        log(`   –ù–∞–π–¥–µ–Ω–æ –≥—Ä—É–ø–ø: ${groups.length}`, 'info');

        if (groups.length > 0) {
          groups.forEach(g => {
            log(`   üìÅ ${g.name} (${g.queries} –∑–∞–ø—Ä–æ—Å–æ–≤)`, 'info');
          });
        } else {
          log(`   ‚ÑπÔ∏è  –ì—Ä—É–ø–ø –ø–æ–∫–∞ –Ω–µ—Ç (–∑–∞–≥—Ä—É–∑–∏—Ç–µ CSV)`, 'info');
        }
      } catch (error) {
        log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
        return;
      }
      log('');

      log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
      log('‚úÖ –í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´!', 'success');
      log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
      log('');
      log('–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å: index.html', 'success');
    }

    // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', () => {
      setTimeout(testAPI, 500);
    });
  </script>
</body>

</html>