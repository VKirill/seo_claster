# ๐ SERP Monitoring Scripts

ะฃัะธะปะธัั ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ ะธ ัะฟัะฐะฒะปะตะฝะธั ะฟัะพัะตััะพะผ ะทะฐะณััะทะบะธ SERP ะดะฐะฝะฝัั ะธะท XMLStock API.

## ๐ ะกะบัะธะฟัั

### 1. `check_serp_progress.py` - ะัะพะณัะตัั ะทะฐะณััะทะบะธ SERP

ะะพะบะฐะทัะฒะฐะตั ัะตะบััะธะน ััะฐััั ะทะฐะณััะทะบะธ SERP ะดะฐะฝะฝัั ะดะปั ะณััะฟะฟั.

```bash
python scripts\serp_monitoring\check_serp_progress.py ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั
```

**ะัะฒะพะดะธั:**
- ะกัะฐัะธััะธะบั ะฟะพ ััะฐัััะฐะผ (pending/processing/completed/failed)
- ะะพะปะธัะตััะฒะพ ะทะฐะฟัะพัะพะฒ ะฑะตะท URL ะดะฐะฝะฝัั
- ะัะพัะตะฝั ะทะฐะฟะพะปะฝะตะฝะธั

---

### 2. `auto_fix.py` - ะะฒัะพะผะฐัะธัะตัะบะพะต ะธัะฟัะฐะฒะปะตะฝะธะต

ะกะฑัะฐััะฒะฐะตั ะทะฐััััะฒัะธะต ะทะฐะฟัะพัั (processing ััะฐััะต 1 ัะฐัะฐ) ะพะฑัะฐัะฝะพ ะฒ pending.

```bash
python scripts\serp_monitoring\auto_fix.py ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั
```

**ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั:**
- req_id ะธััะตะบะปะธ (ะพัะธะฑะบะฐ 203 ะพั XMLStock)
- ะะฐะฟัะพัั ะทะฐััััะปะธ ะฒ processing ะฑะพะปััะต ัะฐัะฐ

---

### 3. `fetch_pending_reqids.py` - ะะพะปััะตะฝะธะต ะฟะพ req_id

ะััะฐะตััั ะฟะพะปััะธัั ัะตะทัะปััะฐัั ะฟะพ ัััะตััะฒัััะธะผ req_id ะฒ ััะฐัััะต pending.

```bash
python scripts\serp_monitoring\fetch_pending_reqids.py ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั [ะผะฐะบั_ะทะฐะฟัะพัะพะฒ] [ะทะฐะดะตัะถะบะฐ]

# ะัะธะผะตัั:
python scripts\serp_monitoring\fetch_pending_reqids.py ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั
python scripts\serp_monitoring\fetch_pending_reqids.py ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั 500 0.3
```

**ะงัะพ ะดะตะปะฐะตั:**
- ะััะฐะตััั ะฟะพะปััะธัั ะดะฐะฝะฝัะต ะฟะพ req_id
- ะัะปะธ ะดะฐะฝะฝัะต ะณะพัะพะฒั - ัะพััะฐะฝัะตั ะฒ ะะ
- ะัะปะธ req_id ะธัััะบ (203) - ัะฑัะฐััะฒะฐะตั ะฒ pending ะฑะตะท req_id
- ะัะปะธ ะตัั ะฝะต ะณะพัะพะฒะพ (202) - ะพััะฐะฒะปัะตั ะบะฐะบ ะตััั

---

### 4. `reset_failed_null.py` - ะกะฑัะพั failed ะฑะตะท ะพัะธะฑะบะธ

ะกะฑัะฐััะฒะฐะตั failed ะทะฐะฟัะพัั ั ะฟััััะผ ัะพะพะฑัะตะฝะธะตะผ ะพะฑ ะพัะธะฑะบะต ะพะฑัะฐัะฝะพ ะฒ pending.

```bash
python scripts\serp_monitoring\reset_failed_null.py ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั
```

**ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั:**
- ะะพัะปะต ะฟัะตัะฒะฐะฝะฝะพะณะพ ะฟัะพัะตััะฐ
- ะััั ะผะฝะพะณะพ failed ั NULL ะพัะธะฑะบะพะน (ััะฐััะต ะทะฐะฟะธัะธ)

---

### 5. `check_failed_errors.py` - ะะฝะฐะปะธะท ะพัะธะฑะพะบ

ะะพะบะฐะทัะฒะฐะตั ัะพะฟ ะพัะธะฑะพะบ ะฒ failed ะทะฐะฟัะพัะฐั.

```bash
python scripts\serp_monitoring\check_failed_errors.py
```

**ะะพะปะตะทะฝะพ ะดะปั:**
- ะะพะฝััั ะฟะพัะตะผั ะทะฐะฟัะพัั ัะตะนะปัััั
- ะะฐะนัะธ failed ั req_id (ะบะพัะพััะต ะผะพะถะฝะพ ะฟะพะฟัะพะฑะพะฒะฐัั ะฟะพะปััะธัั)

---

### 6. `check_pending_details.py` - ะะตัะฐะปะธ pending

ะะพะบะฐะทัะฒะฐะตั ัะบะพะปัะบะพ pending ะทะฐะฟัะพัะพะฒ ั req_id ะธ ะฑะตะท, ั ะฟัะธะผะตัะฐะผะธ.

```bash
python scripts\serp_monitoring\check_pending_details.py
```

---

## ๐ ะขะธะฟะธัะฝัะน workflow

### ะะฐะฟััะบ ะทะฐะณััะทะบะธ SERP ะดะฐะฝะฝัั

```bash
# 1. ะัะพะฒะตััะตะผ ัะตะบััะธะน ะฟัะพะณัะตัั
python scripts\serp_monitoring\check_serp_progress.py ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั

# 2. ะัะฟัะฐะฒะปัะตะผ ะทะฐััััะฒัะธะต/failed ะทะฐะฟัะพัั
python scripts\serp_monitoring\auto_fix.py ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั
python scripts\serp_monitoring\reset_failed_null.py ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั

# 3. ะะฐะฟััะบะฐะตะผ ะพัะฝะพะฒะฝะพะน ะฟัะพัะตัั
python main.py ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั

# 4. ะะพะฝะธัะพัะธะผ ะฟัะพะณัะตัั
python scripts\serp_monitoring\check_serp_progress.py ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั
```

### ะัะปะธ ะฟัะพัะตัั ะฟัะตัะฒะฐะปัั

```bash
# 1. ะกะฑัะพั ะทะฐััััะฒัะธั processing (req_id ะธััะตะบะปะธ)
python scripts\serp_monitoring\auto_fix.py ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั

# 2. ะะพะฟััะบะฐ ะฟะพะปััะธัั ะดะฐะฝะฝัะต ะฟะพ pending req_id
python scripts\serp_monitoring\fetch_pending_reqids.py ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั

# 3. ะะตัะตะทะฐะฟััะบ
python main.py ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั
```

---

## โ๏ธ ะะฐัััะพะนะบะธ ะฒ ัะบัะธะฟัะฐั

### XMLStock API ะบะพะฝัะธะณ

ะ `fetch_pending_reqids.py`:
```python
USER = "11396"
KEY = "b3c2f28ec0a90b44e486af55c2f6b270"
URL = "https://xmlstock.com/yandex/xml/"
```

### ะะฐะทะฐ ะดะฐะฝะฝัั

ะัะต ัะบัะธะฟัั ะธัะฟะพะปัะทััั:
```python
db_path = "output/master_queries.db"
```

---

## ๐ ะคะพัะผะฐั ะฒัะฒะพะดะฐ

### check_serp_progress.py
```
๐ ะะะะะะะกะก ะะะะะะะะะะฏ SERP ะะะฏ ะะะฃะะะซ "ะฝะธะบะพะปะฐะน_ััะดะพัะฒะพัะตั"
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  โ completed          7435
  โธ๏ธ pending           11491
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  ๐ ะะกะะะ:           18926
  ๐ ะะะ SERP URL:    11491 (60.7%)
```

### auto_fix.py
```
๐ง ะะะขะะะะขะะงะะกะะะ ะะกะะะะะะะะะ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะกะฑัะพัะตะฝะพ: 450 ะทะฐะฟัะพัะพะฒ (processing โ pending)

๐ ะกัะฐัะธััะธะบะฐ:
  completed          7435
  pending           11491
```

---

## ๐ง Troubleshooting

### ะัะธะฑะบะฐ: "no such table: master_queries"

ะะฐะทะฐ ะดะฐะฝะฝัั ะฝะต ัะพะทะดะฐะฝะฐ. ะะฐะฟัััะธัะต:
```bash
python main.py <ะณััะฟะฟะฐ>
```

### ะะฝะพะณะพ failed ั NULL ะพัะธะฑะบะพะน

ะะฐะฟัััะธัะต ัะฑัะพั:
```bash
python scripts\serp_monitoring\reset_failed_null.py <ะณััะฟะฟะฐ>
```

### req_id ะธััะตะบะปะธ (ะพัะธะฑะบะฐ 203)

ะะฐะฟัััะธัะต ะฐะฒัะพ-ะธัะฟัะฐะฒะปะตะฝะธะต:
```bash
python scripts\serp_monitoring\auto_fix.py <ะณััะฟะฟะฐ>
```

---

## ๐ ะะพะณะธัะพะฒะฐะฝะธะต

ะัะต ัะบัะธะฟัั ะฒัะฒะพะดัั ะดะตัะฐะปัะฝัั ะธะฝัะพัะผะฐัะธั ะฒ ะบะพะฝัะพะปั.
ะัะฝะพะฒะฝะพะน ะฟัะพัะตัั (`main.py`) ัะฐะบะถะต ะปะพะณะธััะตั:
- ะัะฟัะฐะฒะบั ะทะฐะฟัะพัะพะฒ (ะฟะพะปััะตะฝะธะต req_id)
- ะะพะปััะตะฝะธะต ัะตะทัะปััะฐัะพะฒ
- **ะกะะฅะะะะะะะ ะ ะะ** ั ะดะตัะฐะปัะผะธ (URLs, LSI ััะฐะทั)

ะัะธะผะตั ะฒัะฒะพะดะฐ:
```
   ๐พ ะกะพััะฐะฝะตะฝะธะต ะฑะฐััะฐ ะธะท 50 ัะตะทัะปััะฐัะพะฒ ะฒ ะะ...
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
     โ 'ะฝะธะบะพะปะฐะน ััะดะพัะฒะพัะตั': 20 URLs, 45 LSI ััะฐะท
     โ 'ะผะพัะธ ะฝะธะบะพะปะฐั ััะดะพัะฒะพััะฐ': 20 URLs, 38 LSI ััะฐะท
     โ 'ะผะพะปะธัะฒะฐ ะฝะธะบะพะปะฐั ััะดะพัะฒะพััั': 20 URLs, 42 LSI ััะฐะท
     ... (ะตัั 46 ะทะฐะฟัะพัะพะฒ)
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   โ ะกะพััะฐะฝะตะฝะพ ะฒ ะะ: 50/50 ะทะฐะฟัะพัะพะฒ
```





