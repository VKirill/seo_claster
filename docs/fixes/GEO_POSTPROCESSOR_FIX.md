# üåç –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤ –ø–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (—ç—Ç–∞–ø –ø–æ—Å–ª–µ –æ—Å–Ω–æ–≤–Ω–æ–π SERP-–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏) –∑–∞–ø—Ä–æ—Å—ã **–ë–ï–ó –≥–µ–æ** –ø–æ–ø–∞–¥–∞–ª–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä—ã **–° –≥–µ–æ** –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç.

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:

```
–ö–ª–∞—Å—Ç–µ—Ä: "–∫—É–ø–∏—Ç—å —Å–∫—É–¥ –≤ –º–æ—Å–∫–≤–µ" (ID 626, —Å –≥–µ–æ: –ú–æ—Å–∫–≤–∞)
–ó–∞–ø—Ä–æ—Å—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ:
- –∫—É–ø–∏—Ç—å —Å–∫—É–¥ –≤ –º–æ—Å–∫–≤–µ
- —Å–∫—É–¥ –º–æ—Å–∫–≤–∞ —Ü–µ–Ω–∞
- –∫–æ–º–ø–ª–µ–∫—Ç 11 —Å–∫—É–¥         ‚ùå –ë–ï–ó –ì–ï–û!
- –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ —Å–∫—É–¥ –≤ –º–æ—Å–∫–≤–µ
- —Å–∫—É–¥ –ª–µ—Ä—É–∞               ‚ùå –ë–ï–ó –ì–ï–û!
- –º–∞–≥–∞–∑–∏–Ω—ã —Å–∫—É–¥ –≤ –º–æ—Å–∫–≤–µ
- —Å–∫—É–¥ —ç–ª–µ–∫—Ç—Ä–æ—â–∏—Ç–æ–≤–∞—è      ‚ùå –ë–ï–ó –ì–ï–û!
```

**–ü—Ä–∏—á–∏–Ω–∞**: –û–¥–∏–Ω–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –≥–µ–æ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–ª–∏—Å—å –∫ –∫–ª–∞—Å—Ç–µ—Ä–∞–º —Å –≥–µ–æ, –µ—Å–ª–∏ —É –Ω–∏—Ö –±—ã–ª–∏ –ø–æ—Ö–æ–∂–∏–µ SERP URL.

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞

–í —Ñ–∞–π–ª–µ `seo_analyzer/clustering/cluster_postprocessor.py` –º–µ—Ç–æ–¥ `_reattach_singletons()` –ø—Ä–∏–∫—Ä–µ–ø–ª—è–ª –æ–¥–∏–Ω–æ—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–ª–∞—Å—Ç–µ—Ä–∞–º **–¢–û–õ–¨–ö–û –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ö–æ–∂–µ—Å—Ç–∏ SERP**, –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—è –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.

### –ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):

```python
def _reattach_singletons(self, clusters, query_urls):
    singles = [c[0] for c in clusters if len(c) == 1]
    non_single_clusters = [c for c in clusters if len(c) > 1]
    
    for single in singles:
        best_cid = None
        best_score = 0
        urls_single = query_urls.get(single, [])
        
        for idx, cluster in enumerate(non_single_clusters):
            score = 0
            for member in cluster[:self.max_compare]:
                score = max(score, self._similarity(urls_single, query_urls.get(member, [])))
                if score >= self.base_threshold:
                    break
            
            # ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏!
            if score > best_score and score >= self.base_threshold:
                best_score = score
                best_cid = idx
        
        if best_cid is not None:
            non_single_clusters[best_cid].append(single)  # ‚ùå –ü—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–µ–æ!
```

---

## –†–µ—à–µ–Ω–∏–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ –≤ `ClusterPostprocessor`

**–§–∞–π–ª**: `seo_analyzer/clustering/cluster_postprocessor.py`

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è:

1. **–î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `geo_dicts`** –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä:

```python
def __init__(
    self,
    base_threshold: int,
    top_positions: int,
    max_cluster_size: int = 12,
    threshold_step: int = 1,
    max_threshold: int | None = None,
    max_compare: int = 15,
    geo_dicts: Optional[Dict[str, Set[str]]] = None,  # ‚úÖ –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä
):
```

2. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è `SemanticClusterChecker`** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏:

```python
# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —á–µ–∫–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–µ–æ
from .semantic_checker import SemanticClusterChecker
self.semantic_checker = SemanticClusterChecker(geo_dicts=geo_dicts) if geo_dicts else None
```

3. **–ú–µ—Ç–æ–¥ `_reattach_singletons()` —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–µ–æ–≥—Ä–∞—Ñ–∏—é**:

```python
def _reattach_singletons(self, clusters, query_urls):
    singles = [c[0] for c in clusters if len(c) == 1]
    non_single_clusters = [c for c in clusters if len(c) > 1]
    
    # ‚úÖ –ò–∑–≤–ª–µ–∫–∞–µ–º –≥–µ–æ–≥—Ä–∞—Ñ–∏—é –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    query_geo_dict = {}
    if self.semantic_checker:
        for single in singles:
            query_geo_dict[single] = self.semantic_checker.extract_geo(single)
        for cluster in non_single_clusters:
            for query in cluster:
                if query not in query_geo_dict:
                    query_geo_dict[query] = self.semantic_checker.extract_geo(query)
    
    for single in singles:
        best_cid = None
        best_score = 0
        urls_single = query_urls.get(single, [])
        single_geo = query_geo_dict.get(single)  # ‚úÖ –ì–µ–æ–≥—Ä–∞—Ñ–∏—è –æ–¥–∏–Ω–æ—á–∫–∏
        
        for idx, cluster in enumerate(non_single_clusters):
            if len(cluster) >= self.max_cluster_size:
                continue
            
            # ‚úÖ –ü–†–û–í–ï–†–ö–ê –ì–ï–û–ì–†–ê–§–ò–ò: –æ–¥–∏–Ω–æ—á–∫–∞ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –¢–£ –ñ–ï –≥–µ–æ–≥—Ä–∞—Ñ–∏—é —á—Ç–æ –∏ –∫–ª–∞—Å—Ç–µ—Ä
            if self.semantic_checker:
                cluster_geo = query_geo_dict.get(cluster[0])
                
                # –ï—Å–ª–∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç - –ü–†–û–ü–£–°–ö–ê–ï–ú —ç—Ç–æ—Ç –∫–ª–∞—Å—Ç–µ—Ä
                if single_geo != cluster_geo:
                    continue
            
            # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏—è ...
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω –≤—ã–∑–æ–≤ –≤ pipeline

**–§–∞–π–ª**: `pipeline/stages/cluster_postprocess.py`

```python
post = ClusterPostprocessor(
    base_threshold=base_threshold,
    top_positions=top_positions,
    max_cluster_size=max_cluster_size,
    threshold_step=threshold_step,
    geo_dicts=analyzer.geo_dicts,  # ‚úÖ –ü–µ—Ä–µ–¥–∞–µ–º –≥–µ–æ-—Å–ª–æ–≤–∞—Ä–∏
)
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```
–ö–ª–∞—Å—Ç–µ—Ä: "–∫—É–ø–∏—Ç—å —Å–∫—É–¥ –≤ –º–æ—Å–∫–≤–µ" (ID 626, —Å –≥–µ–æ: –ú–æ—Å–∫–≤–∞)
–ó–∞–ø—Ä–æ—Å—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ:
‚úÖ –∫—É–ø–∏—Ç—å —Å–∫—É–¥ –≤ –º–æ—Å–∫–≤–µ
‚úÖ —Å–∫—É–¥ –º–æ—Å–∫–≤–∞ —Ü–µ–Ω–∞
‚úÖ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ —Å–∫—É–¥ –≤ –º–æ—Å–∫–≤–µ
‚úÖ –º–∞–≥–∞–∑–∏–Ω—ã —Å–∫—É–¥ –≤ –º–æ—Å–∫–≤–µ

–ö–ª–∞—Å—Ç–µ—Ä: "–∫–æ–º–ø–ª–µ–∫—Ç 11 —Å–∫—É–¥" (ID 1500, –ë–ï–ó –≥–µ–æ)
–ó–∞–ø—Ä–æ—Å—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ:
‚úÖ –∫–æ–º–ø–ª–µ–∫—Ç 11 —Å–∫—É–¥
‚úÖ —Å–∫—É–¥ –ª–µ—Ä—É–∞
‚úÖ —Å–∫—É–¥ —ç–ª–µ–∫—Ç—Ä–æ—â–∏—Ç–æ–≤–∞—è
```

–¢–µ–ø–µ—Ä—å –∑–∞–ø—Ä–æ—Å—ã **—Å –≥–µ–æ** –∏ **–±–µ–∑ –≥–µ–æ** –∫–ª–∞—Å—Ç–µ—Ä–∏–∑—É—é—Ç—Å—è **–æ—Ç–¥–µ–ª—å–Ω–æ** –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö, –≤–∫–ª—é—á–∞—è –ø–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫—É!

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. **–û—Å–Ω–æ–≤–Ω–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è** (`AdvancedSERPClusterer`) - —É–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–µ–æ–≥—Ä–∞—Ñ–∏—é ‚úÖ
2. **–ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞** (`ClusterPostprocessor`) - **—Ç–µ–ø–µ—Ä—å —Ç–æ–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≥–µ–æ–≥—Ä–∞—Ñ–∏—é** ‚úÖ

### –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
python main.py —Å–∫—É–¥ --export-csv --export-excel
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —á—Ç–æ:
- –ó–∞–ø—Ä–æ—Å—ã "—Å–∫—É–¥ –º–æ—Å–∫–≤–∞" –Ω–µ —Å–º–µ—à–∞–Ω—ã —Å "—Å–∫—É–¥" (–±–µ–∑ –≥–µ–æ)
- –ó–∞–ø—Ä–æ—Å—ã "–∫—É–ø–∏—Ç—å —Å–∫—É–¥ –≤ –º–æ—Å–∫–≤–µ" –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ –≥–µ–æ —Ç–∏–ø–∞ "—Å–∫—É–¥ –ª–µ—Ä—É–∞"

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≥–µ–æ–≥—Ä–∞—Ñ–∏—è?

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ **Natasha NER** (Named Entity Recognition), –∫–æ—Ç–æ—Ä–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã (–≥–æ—Ä–æ–¥–∞, —Ä–µ–≥–∏–æ–Ω—ã) –≤–æ **–≤—Å–µ—Ö –ø–∞–¥–µ–∂–∞—Ö**:

```python
"–º–æ—Å–∫–≤–∞" ‚Üí "–º–æ—Å–∫–≤–∞"
"–≤ –º–æ—Å–∫–≤–µ" ‚Üí "–º–æ—Å–∫–≤–∞"
"–¥–ª—è –º–æ—Å–∫–≤—ã" ‚Üí "–º–æ—Å–∫–≤–∞"
"—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥" ‚Üí "—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥"
"–≤ –ø–µ—Ç–µ—Ä–±—É—Ä–≥–µ" ‚Üí "—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥"
```

### –ü—Ä–∞–≤–∏–ª–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏:

1. **–ó–∞–ø—Ä–æ—Å—ã —Å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –≥–µ–æ–≥—Ä–∞—Ñ–∏–µ–π** ‚Üí –º–æ–≥—É—Ç –±—ã—Ç—å –≤ –æ–¥–Ω–æ–º –∫–ª–∞—Å—Ç–µ—Ä–µ
2. **–ó–∞–ø—Ä–æ—Å—ã —Å —Ä–∞–∑–Ω–æ–π –≥–µ–æ–≥—Ä–∞—Ñ–∏–µ–π** ‚Üí –í–°–ï–ì–î–ê –≤ —Ä–∞–∑–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö
3. **–ó–∞–ø—Ä–æ—Å—ã —Å –≥–µ–æ vs –±–µ–∑ –≥–µ–æ** ‚Üí –í–°–ï–ì–î–ê –≤ —Ä–∞–∑–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö

### –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è:

1. **–û—Å–Ω–æ–≤–Ω–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è** (`AdvancedSERPClusterer.cluster_by_serp()`)
   - –°—Ç—Ä–æ–∫–∏ 454-481: –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º —Å–µ–≥–º–µ–Ω—Ç–∞–º
   - –°—Ç—Ä–æ–∫–∏ 523-528: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏
   - –°—Ç—Ä–æ–∫–∏ 536-544: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä

2. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** (`SemanticClusterChecker.are_queries_compatible()`)
   - –°—Ç—Ä–æ–∫–∏ 239-249: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏

3. **–ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞** (`ClusterPostprocessor._reattach_singletons()`)
   - **–ù–û–í–û–ï**: –°—Ç—Ä–æ–∫–∏ 162-168: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ –ø—Ä–∏ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–∏ –æ–¥–∏–Ω–æ—á–µ–∫

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–æ–≤ –≤ –∫–æ–Ω—Ü–µ –∑–∞–ø—Ä–æ—Å–∞

### –ü—Ä–æ–±–ª–µ–º–∞ #2

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±–Ω–∞—Ä—É–∂–∏–ª–∞—Å—å **–≤—Ç–æ—Ä–∞—è –ø—Ä–æ–±–ª–µ–º–∞**: Natasha NER –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–ª–∞ –≥–æ—Ä–æ–¥–∞ **–≤ –∫–æ–Ω—Ü–µ –∑–∞–ø—Ä–æ—Å–∞ –±–µ–∑ –ø—Ä–µ–¥–ª–æ–≥–∞**:

```
‚ùå "—Å–∫—É–¥ –≤ –æ—Ñ–∏—Å –º–æ—Å–∫–≤–∞" ‚Üí None (Natasha –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–ª–∞ "–º–æ—Å–∫–≤–∞")
‚ùå "—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∫—É–¥ –≤ –æ—Ñ–∏—Å–µ –º–æ—Å–∫–≤–∞" ‚Üí None 
‚úÖ "—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫—É–¥ –º–æ—Å–∫–≤–∞" ‚Üí "–º–æ—Å–∫–≤–∞" (—Ä–∞–±–æ—Ç–∞–µ—Ç)
‚úÖ "–∫—É–ø–∏—Ç—å —Å–∫—É–¥ –≤ –º–æ—Å–∫–≤–µ" ‚Üí "–º–æ—Å–∫–≤–∞" (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–µ–¥–ª–æ–≥–æ–º!)
```

**–ü—Ä–∏—á–∏–Ω–∞**: Natasha NER —Ç—Ä–µ–±—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–≥ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è Named Entities. –°–ª–æ–≤–æ "–º–æ—Å–∫–≤–∞" –≤ –∫–æ–Ω—Ü–µ –±–µ–∑ –ø—Ä–µ–¥–ª–æ–≥–∞ –≤—ã–≥–ª—è–¥–∏—Ç –¥–ª—è –Ω–µ–µ –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ —Å–ª–æ–≤–æ.

### –†–µ—à–µ–Ω–∏–µ #2

–î–æ–±–∞–≤–ª–µ–Ω **fallback –Ω–∞ –ø–æ–∏—Å–∫ –ø–æ —Å–ª–æ–≤–∞–º** –≤ –º–µ—Ç–æ–¥ `extract_geo()` –∫–ª–∞—Å—Å–∞ `SemanticClusterChecker`:

**–§–∞–π–ª**: `seo_analyzer/clustering/semantic_checker.py`

```python
@lru_cache(maxsize=10000)
def extract_geo(self, query: str) -> Optional[str]:
    """
    –ò–∑–≤–ª–µ–∫–∞–µ—Ç –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫—É—é –ø—Ä–∏–≤—è–∑–∫—É —á–µ—Ä–µ–∑ Natasha NER + Fallback.
    
    –ê–ª–≥–æ—Ä–∏—Ç–º:
    1. –ü—ã—Ç–∞–µ–º—Å—è —á–µ—Ä–µ–∑ Natasha NER (—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è "–≤ –º–æ—Å–∫–≤–µ", "–¥–ª—è –º–æ—Å–∫–≤—ã")
    2. –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∞ - fallback –Ω–∞ –ø–æ–∏—Å–∫ –ø–æ —Å–ª–æ–≤–∞–º (–¥–ª—è "–º–æ—Å–∫–≤–∞" –≤ –∫–æ–Ω—Ü–µ)
    """
    
    # –®–ê–ì 1: –ü—ã—Ç–∞–µ–º—Å—è —á–µ—Ä–µ–∑ Natasha NER
    if self.natasha_enabled:
        try:
            query_capitalized = self._capitalize_known_cities(query)
            doc = Doc(query_capitalized)
            doc.segment(self.segmenter)
            doc.tag_ner(self.ner_tagger)
            
            for span in doc.spans:
                if span.type == self.LOC:
                    location_lower = span.text.lower()
                    if self.geo_validator.is_valid_city(location_lower):
                        return self.geo_validator.normalize_city(location_lower)
        except Exception:
            pass
    
    # –®–ê–ì 2: Fallback - –ø—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ –ø–æ —Å–ª–æ–≤–∞–º –∑–∞–ø—Ä–æ—Å–∞
    words = query.lower().split()
    for word in words:
        clean_word = word.strip('.,!?;:()[]{}')
        if self.geo_validator.is_valid_city(clean_word):
            return self.geo_validator.normalize_city(clean_word)
    
    return None
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

–¢–µ–ø–µ—Ä—å **–í–°–ï –≤–∞—Ä–∏–∞–Ω—Ç—ã** –∑–∞–ø—Ä–æ—Å–æ–≤ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

```
‚úÖ "—Å–∫—É–¥ –≤ –æ—Ñ–∏—Å –º–æ—Å–∫–≤–∞" ‚Üí "–º–æ—Å–∫–≤–∞"
‚úÖ "—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∫—É–¥ –≤ –æ—Ñ–∏—Å–µ –º–æ—Å–∫–≤–∞" ‚Üí "–º–æ—Å–∫–≤–∞"
‚úÖ "—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫—É–¥ –º–æ—Å–∫–≤–∞" ‚Üí "–º–æ—Å–∫–≤–∞"
‚úÖ "–∫—É–ø–∏—Ç—å —Å–∫—É–¥ –≤ –º–æ—Å–∫–≤–µ" ‚Üí "–º–æ—Å–∫–≤–∞"
‚úÖ "—Å–∫—É–¥ –º–æ—Å–∫–≤–∞ —Ü–µ–Ω–∞" ‚Üí "–º–æ—Å–∫–≤–∞"
‚úÖ "—Å–∫—É–¥ –≤ –æ—Ñ–∏—Å" ‚Üí None (–ë–ï–ó –ì–ï–û)
‚úÖ "—É—Å–ª—É–≥–∏ —Å–∫—É–¥" ‚Üí None (–ë–ï–ó –ì–ï–û)
```

---

## –î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**8 –¥–µ–∫–∞–±—Ä—è 2025**

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ 2 —ç—Ç–∞–ø–∞:
1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ –≤ `ClusterPostprocessor._reattach_singletons()`
2. –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ –ø–æ–∏—Å–∫ –ø–æ —Å–ª–æ–≤–∞–º –≤ `SemanticClusterChecker.extract_geo()`

