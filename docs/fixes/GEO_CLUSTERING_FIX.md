# üåç –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏

## –ü—Ä–æ–±–ª–µ–º–∞

–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —Å–∫—É–¥ –º–æ—Å–∫–≤–∞") –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–æ–≤–∞–ª–∏—Å—å –≤–º–µ—Å—Ç–µ —Å –æ–±—ã—á–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ ("–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∏ —Å–∫—É–¥"), —Ö–æ—Ç—è –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ –±—ã—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö.

### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:

```json
{
  "name": "–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∏ —Å–∫—É–¥",
  "keywords": [
    {
      "keyword": "–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∏ —Å–∫—É–¥",
      "main_intent": "commercial"
    },
    {
      "keyword": "–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —Å–∫—É–¥ –º–æ—Å–∫–≤–∞",  // ‚ùå –ì–ï–û-–∑–∞–ø—Ä–æ—Å –≤ –æ–±—ã—á–Ω–æ–º –∫–ª–∞—Å—Ç–µ—Ä–µ
      "main_intent": "commercial_geo"
    }
  ]
}
```

## –ü—Ä–∏—á–∏–Ω–∞

–í `seo_analyzer/clustering/serp_advanced_clusterer.py` –±—ã–ª–∞ –æ—à–∏–±–∫–∞ –æ—Ç—Å—Ç—É–ø–æ–≤:
- –ë–ª–æ–∫ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 523-558) –Ω–∞—Ö–æ–¥–∏–ª—Å—è **–≤–Ω–µ** —Ü–∏–∫–ª–∞ `for i, query in enumerate(geo_queries)`
- –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–µ–æ-—Å–µ–≥–º–µ–Ω—Ç–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è —Ç–æ–ª—å–∫–æ **–ø–µ—Ä–≤—ã–π** –∑–∞–ø—Ä–æ—Å
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–ø—É—Å–∫–∞–ª–∏—Å—å –∏ –ø–æ–ø–∞–¥–∞–ª–∏ –≤ –æ–±—â–∏–π –ø—É–ª

## –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—Ç—Å—Ç—É–ø—ã –≤ `serp_advanced_clusterer.py`

**–î–û** (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```python
for geo_segment, geo_queries in geo_groups.items():
    for i, query in enumerate(geo_queries, 1):
        # ... –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ...
    
    # ‚ùå –ë–ª–æ–∫ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –í–ù–ï —Ü–∏–∫–ª–∞ –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º!
    added = False
    for cid in candidate_clusters:
        # ... –ª–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–ª–∞—Å—Ç–µ—Ä ...
```

**–ü–û–°–õ–ï** (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```python
for geo_segment, geo_queries in geo_groups.items():
    for i, query in enumerate(geo_queries, 1):
        # ... –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ...
        
        # ‚úÖ –ë–ª–æ–∫ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ –í–ù–£–¢–†–ò —Ü–∏–∫–ª–∞ –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º!
        added = False
        for cid in candidate_clusters:
            # ... –ª–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–ª–∞—Å—Ç–µ—Ä ...
```

### 2. –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `geo` –≤ JSON —ç–∫—Å–ø–æ—Ä—Ç

–¢–µ–ø–µ—Ä—å –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∫–ª–∞—Å—Ç–µ—Ä—ã –∏–º–µ—é—Ç –º–µ—Ç–∫—É:

```json
{
  "name": "–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —Å–∫—É–¥ –º–æ—Å–∫–≤–∞",
  "target_url": "/skud/moscow/",
  "total_frequency": 150,
  "funnel_stage": "Interest",
  "main_intent": "commercial_geo",
  "geo": "–º–æ—Å–∫–≤–∞",  // ‚úÖ –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è –º–µ—Ç–∫–∞
  "cluster_id": 42,
  "keywords_count": 5,
  "keywords": [...]
}
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è

### 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏

```python
# Natasha NER –∏–∑–≤–ª–µ–∫–∞–µ—Ç –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏
query_geo_dict = {}
for query in queries:
    geo = semantic_checker.extract_geo(query)
    # geo = "–º–æ—Å–∫–≤–∞" –∏–ª–∏ None
    query_geo_dict[query] = geo
```

### 2. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏

```python
geo_groups = {
    '__no_geo__': [...],           # –ó–∞–ø—Ä–æ—Å—ã –±–µ–∑ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏
    '–º–æ—Å–∫–≤–∞': [...],                # –ó–∞–ø—Ä–æ—Å—ã –ø—Ä–æ –ú–æ—Å–∫–≤—É
    '—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥': [...],       # –ó–∞–ø—Ä–æ—Å—ã –ø—Ä–æ –°–ü–±
    '–∫—Ä–∞—Å–Ω–æ–¥–∞—Ä': [...]              # –ó–∞–ø—Ä–æ—Å—ã –ø—Ä–æ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä
}
```

### 3. –†–∞–∑–¥–µ–ª—å–Ω–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è

```python
for geo_segment, geo_queries in geo_groups.items():
    # –ö–ª–∞—Å—Ç–µ—Ä–∏–∑—É–µ–º –¢–û–õ–¨–ö–û –∑–∞–ø—Ä–æ—Å—ã —ç—Ç–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
    for query in geo_queries:
        similar_queries = find_similar_queries_fast(query, ...)
        
        # –§–∏–ª—å—Ç—Ä: –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å—ã —Å –¢–û–ô –ñ–ï –≥–µ–æ–≥—Ä–∞—Ñ–∏–µ–π
        similar_same_geo = {
            sq: score for sq, score in similar_queries.items()
            if query_geo_dict.get(sq) == query_geo_dict.get(query)
        }
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –≤–º–µ—Å—Ç–µ
- ‚ùå –ì–µ–æ-–∑–∞–ø—Ä–æ—Å—ã —Å–º–µ—à–∏–≤–∞–ª–∏—Å—å —Å –æ–±—ã—á–Ω—ã–º–∏
- ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã

### –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí 100 —Å –≥–µ–æ + 900 –±–µ–∑ –≥–µ–æ
- ‚úÖ 100 –≥–µ–æ-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ –∫–∞–∂–¥–æ–º—É –≥–æ—Ä–æ–¥—É
- ‚úÖ 900 –æ–±—ã—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- ‚úÖ –í JSON –≤–∏–¥–Ω–æ –∫–∞–∫–æ–π –∫–ª–∞—Å—Ç–µ—Ä –∫ –∫–∞–∫–æ–º—É –≥–æ—Ä–æ–¥—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è

## –ü—Ä–∏–º–µ—Ä –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏

### –ö–ª–∞—Å—Ç–µ—Ä –±–µ–∑ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏:
```json
{
  "name": "–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∏ —Å–∫—É–¥",
  "total_frequency": 900,
  "main_intent": "commercial",
  "keywords": [
    "–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∏ —Å–∫—É–¥",
    "–∫–∞–º–µ—Ä—ã –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è —Å–∫—É–¥",
    "ip –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —Å–∫—É–¥"
  ]
}
```

### –ö–ª–∞—Å—Ç–µ—Ä —Å –≥–µ–æ–≥—Ä–∞—Ñ–∏–µ–π (–ú–æ—Å–∫–≤–∞):
```json
{
  "name": "–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —Å–∫—É–¥ –º–æ—Å–∫–≤–∞",
  "total_frequency": 150,
  "main_intent": "commercial_geo",
  "geo": "–º–æ—Å–∫–≤–∞",
  "keywords": [
    "–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —Å–∫—É–¥ –º–æ—Å–∫–≤–∞",
    "—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫—É–¥ –º–æ—Å–∫–≤–∞",
    "–∫–∞–º–µ—Ä—ã —Å–∫—É–¥ –º–æ—Å–∫–≤–∞"
  ]
}
```

### –ö–ª–∞—Å—Ç–µ—Ä —Å –≥–µ–æ–≥—Ä–∞—Ñ–∏–µ–π (–°–ü–±):
```json
{
  "name": "–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —Å–∫—É–¥ —Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥",
  "total_frequency": 80,
  "main_intent": "commercial_geo",
  "geo": "—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥",
  "keywords": [
    "–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —Å–∫—É–¥ —Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥",
    "–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —Å–∫—É–¥ —Å–ø–±",
    "—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫—É–¥ —Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥"
  ]
}
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–¢–æ—á–Ω–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è**: –ó–∞–ø—Ä–æ—Å—ã –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏
2. **–û—Ç–¥–µ–ª—å–Ω—ã–µ —Ü–µ–ª–µ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã**: –î–ª—è –∫–∞–∂–¥–æ–≥–æ –≥–æ—Ä–æ–¥–∞ —Å–≤–æ—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
3. **–í–∏–¥–∏–º–æ—Å—Ç—å –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏**: –í JSON —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ –¥–ª—è –∫–∞–∫–æ–≥–æ –≥–æ—Ä–æ–¥–∞ –∫–ª–∞—Å—Ç–µ—Ä
4. **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞**: –ó–∞–ø—Ä–æ—Å—ã —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ –Ω–µ —Å–º–µ—à–∏–≤–∞—é—Ç—Å—è

## –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—é
python main.py

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JSON
# output/groups/<–≥—Ä—É–ø–ø–∞>/seo_analysis.json

# –ù–∞–π—Ç–∏ –∫–ª–∞—Å—Ç–µ—Ä—ã —Å –≥–µ–æ–≥—Ä–∞—Ñ–∏–µ–π:
# "geo": "–º–æ—Å–∫–≤–∞"
# "geo": "—Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥"
```

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. `seo_analyzer/clustering/serp_advanced_clusterer.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—Ç—Å—Ç—É–ø—ã (—Å—Ç—Ä–æ–∫–∏ 500-558)
2. `seo_analyzer/export/json_exporter.py` - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `geo` –≤ –∫–ª–∞—Å—Ç–µ—Ä

---

‚úÖ **–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã —Ç–µ–ø–µ—Ä—å –∫–ª–∞—Å—Ç–µ—Ä–∏–∑—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ!**

