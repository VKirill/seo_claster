# Master DB - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Pipeline ‚úÖ

## –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ üöÄ

### 1. –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞

–í `pipeline/analyzer.py` –¥–æ–±–∞–≤–ª–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:

```python
async def _save_to_master_db(self):
    """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Master Query Database"""
    master_db = MasterQueryDatabase()
    master_db.save_queries(
        group_name=group_name,
        df=self.df,  # –í–°–ï –¥–∞–Ω–Ω—ã–µ: –∏–Ω—Ç–µ–Ω—Ç, SERP, –º–µ—Ç—Ä–∏–∫–∏, –±—Ä–µ–Ω–¥—ã
        csv_path=csv_path,
        csv_hash=csv_hash
    )
```

**–ö–æ–≥–¥–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:** –ü–æ—Å–ª–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ (–∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è, –º–µ—Ç—Ä–∏–∫–∏, —ç–∫—Å–ø–æ—Ä—Ç)

### 2. –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ

–í `pipeline/stages/data_loader.py` –¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫—ç—à–µ–π:

```
1. Master DB       (–í–°–Å: –∏–Ω—Ç–µ–Ω—Ç + SERP + –º–µ—Ç—Ä–∏–∫–∏) ‚úÖ
2. query_cache.db  (—á–∞—Å—Ç–∏—á–Ω–æ–µ: –∏–Ω—Ç–µ–Ω—Ç, normalized)
3. CSV —Ñ–∞–π–ª        (—Å –Ω—É–ª—è)
```

**–õ–æ–≥–∏–∫–∞:**
```python
if not csv_changed:
    # –ü—Ä–æ–±—É–µ–º Master DB
    if master_db.group_exists(group_name):
        df = master_db.load_queries(group_name)
        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫—É, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é, SERP –∞–Ω–∞–ª–∏–∑!
    else:
        # –ü—Ä–æ–±—É–µ–º query_cache
        df = query_cache.load_queries(group_name)
```

### 3. –£–º–Ω–æ–µ –ø—Ä–æ–ø—É—Å–∫–∞–Ω–∏–µ —ç—Ç–∞–ø–æ–≤

**–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞** (`pipeline/stages/preprocessor.py`):
```python
if loaded_from_master_db:
    print("‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫—É (–∏–∑ Master DB)")
    return  # –ù–µ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º, –Ω–µ –¥–µ–ª–∞–µ–º NER
```

**–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è** (`pipeline/stages/classifier.py`):
```python
if loaded_from_master_db and 'main_intent' in df:
    print("‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é (–∏–∑ Master DB)")
    return  # –ù–µ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –∏–Ω—Ç–µ–Ω—Ç, –±—Ä–µ–Ω–¥—ã, –≤–æ—Ä–æ–Ω–∫—É
```

**SERP –∞–Ω–∞–ª–∏–∑** - —Ç–æ–∂–µ –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –µ—Å–ª–∏ `serp_found_docs` —É–∂–µ –µ—Å—Ç—å

### 4. –ú–∏–≥—Ä–∞—Ü–∏—è –∏–∑ —Å—Ç–∞—Ä—ã—Ö –ë–î

–°–∫—Ä–∏–ø—Ç `migrate_serp_to_master.py`:
- –ß–∏—Ç–∞–µ—Ç `serp_data.db` (XML –æ—Ç xmlstock)
- **–ü–∞—Ä—Å–∏—Ç XML** ‚Üí –∏–∑–≤–ª–µ–∫–∞–µ—Ç:
  - `top_urls` (TOP-20 URL –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏)
  - `lsi_phrases` (LSI –∏–∑ –ø–∞—Å—Å–∞–∂–µ–π)
  - `offer_info` (–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ)
- –û–±—ä–µ–¥–∏–Ω—è–µ—Ç —Å `query_cache.db` (–∏–Ω—Ç–µ–Ω—Ç, normalized)
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `master_queries.db`

## Workflow üîÑ

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)

```bash
python main.py
```

**–≠—Ç–∞–ø—ã:**
1. –ó–∞–≥—Ä—É–∑–∫–∞ CSV ‚Üí 2 —Å–µ–∫
2. –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è, NER) ‚Üí 30 —Å–µ–∫
3. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–Ω—Ç–µ–Ω—Ç–∞ ‚Üí 9 –º–∏–Ω
4. SERP –∞–Ω–∞–ª–∏–∑ ‚Üí 5-30 –º–∏–Ω
5. –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è ‚Üí 2 –º–∏–Ω
6. –ú–µ—Ç—Ä–∏–∫–∏ (KEI, difficulty) ‚Üí 10 —Å–µ–∫
7. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Master DB** ‚Üí 5 —Å–µ–∫ ‚úÖ
8. –≠–∫—Å–ø–æ—Ä—Ç ‚Üí 20 —Å–µ–∫

**–ò—Ç–æ–≥–æ:** ~16-45 –º–∏–Ω—É—Ç

**–í—ã–≤–æ–¥ –≤ –∫–æ–Ω—Ü–µ:**
```
üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Master Query Database
==========================================
  –ì—Ä—É–ø–ø–∞: –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ
  –ó–∞–ø—Ä–æ—Å–æ–≤: 56,923

üíæ Master DB: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ 56923 –∑–∞–ø—Ä–æ—Å–æ–≤

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:
  ‚úì –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: 56,923
  ‚úì –° –∏–Ω—Ç–µ–Ω—Ç–æ–º: 56,923
  ‚úì –° SERP –¥–∞–Ω–Ω—ã–º–∏: 56,923
  ‚úì –° Yandex Direct: 45,123
  ‚úì –°—Ä–µ–¥–Ω–∏–π KEI: 125.45

üí° –¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
   –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–∑ Master DB –º–≥–Ω–æ–≤–µ–Ω–Ω–æ!
```

### –í—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫ (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç —Å –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–µ–π)

```bash
# –ú–µ–Ω—è–µ–º min_common_urls —Å 7 –Ω–∞ 8
python main.py
```

**–≠—Ç–∞–ø—ã:**
1. **–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Master DB** ‚Üí 3 —Å–µ–∫ ‚úÖ
   ```
   üöÄ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Master DB (–≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–∫–ª—é—á–∞—è SERP + –∏–Ω—Ç–µ–Ω—Ç)...
     ‚úì –ó–∞–ø—Ä–æ—Å–æ–≤: 56,923
     ‚úì –° –∏–Ω—Ç–µ–Ω—Ç–æ–º: 56,923
     ‚úì –° SERP: 56,923
     üí° –ú–æ–∂–Ω–æ —Å—Ä–∞–∑—É —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–µ–π!
   ```

2. ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫—É (–∏–∑ Master DB)
3. ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—é (–∏–∑ Master DB)
4. ‚úÖ –ü—Ä–æ–ø—É—Å–∫–∞–µ–º SERP –∞–Ω–∞–ª–∏–∑ (—É–∂–µ –µ—Å—Ç—å)
5. **–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è —Å –Ω–æ–≤—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏** ‚Üí 30 —Å–µ–∫ üöÄ
6. –ú–µ—Ç—Ä–∏–∫–∏ ‚Üí 10 —Å–µ–∫
7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Master DB ‚Üí 5 —Å–µ–∫
8. –≠–∫—Å–ø–æ—Ä—Ç ‚Üí 20 —Å–µ–∫

**–ò—Ç–æ–≥–æ:** ~1 –º–∏–Ω—É—Ç–∞ –≤–º–µ—Å—Ç–æ 16-45 –º–∏–Ω—É—Ç! üöÄ

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ: 16-45x!**

### –¢—Ä–µ—Ç–∏–π –∑–∞–ø—É—Å–∫ (–µ—â–µ –æ–¥–∏–Ω —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç)

```bash
# –ú–µ–Ω—è–µ–º min_common_urls —Å 8 –Ω–∞ 10
python main.py
```

**–ò—Ç–æ–≥–æ:** ~1 –º–∏–Ω—É—Ç–∞ üöÄ

–ú–æ–∂–Ω–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ!

## –ü–∞—Ä—Å–∏–Ω–≥ XML –∏–∑ serp_data.db üìã

### –ß—Ç–æ –ø–∞—Ä—Å–∏—Ç—Å—è

–§—É–Ω–∫—Ü–∏—è `parse_serp_xml()` –∏–∑–≤–ª–µ–∫–∞–µ—Ç:

```xml
<yandexsearch>
  <response>
    <results>
      <grouping>
        <group>
          <doc>
            <url>https://example.com</url>
            <domain>example.com</domain>
            <title>–ö—É–ø–∏—Ç—å –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ</title>
            
            <!-- –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ -->
            <offer_info>
              <price>15000</price>
              <currency>RUR</currency>
            </offer_info>
            
            <!-- LSI —Ñ—Ä–∞–∑—ã -->
            <passages>
              <passage>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è –ø–æ–¥ –∫–ª—é—á</passage>
            </passages>
          </doc>
        </group>
      </grouping>
    </results>
  </response>
</yandexsearch>
```

### –ß—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ Master DB

```python
{
    'serp_top_urls': [
        {
            'url': 'https://example.com',
            'domain': 'example.com',
            'position': 1,
            'title': '–ö—É–ø–∏—Ç—å –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ',
            'is_commercial': True,  # –µ—Å—Ç—å offer_info
            'offers_count': 3
        },
        # ... –¥–æ 20 URL
    ],
    
    'serp_lsi_phrases': [
        '—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏—è',
        '–º–æ–Ω—Ç–∞–∂ –∫–∞–º–µ—Ä',
        # ... –¥–æ 50 —Ñ—Ä–∞–∑
    ],
    
    'serp_docs_with_offers': 15,  # –∏–∑ 20
    'serp_offer_ratio': 0.75,      # 75%
    'serp_intent': 'commercial'    # –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
}
```

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö üîÑ

### –®–∞–≥ 1: –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
python migrate_serp_to_master.py
```

### –®–∞–≥ 2: –í—ã–±–æ—Ä –≥—Ä—É–ø–ø—ã

```
–ù–∞–π–¥–µ–Ω–æ –≥—Ä—É–ø–ø: 3
  ‚Ä¢ –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ
  ‚Ä¢ —Å–∫—É–¥
  ‚Ä¢ crm

–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:
  1. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≥—Ä—É–ø–ø—ã
  2. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–¥–Ω—É –≥—Ä—É–ø–ø—É
  0. –í—ã—Ö–æ–¥

–í–∞—à –≤—ã–±–æ—Ä: 1
```

### –®–∞–≥ 3: –ü—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–∏

```
================================================================================
–ú–∏–≥—Ä–∞—Ü–∏—è –≥—Ä—É–ø–ø—ã: –≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ
================================================================================

1. –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ query_cache.db...
‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ 56923 –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ –∫—ç—à–∞

2. –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø–∞—Ä—Å–∏–Ω–≥ SERP –¥–∞–Ω–Ω—ã—Ö...
–ü–∞—Ä—Å–∏–Ω–≥ XML: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 56923/56923 [02:15<00:00, 420.12it/s]
‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ 56923 SERP –∑–∞–ø–∏—Å–µ–π

3. –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...
‚úì –î–∞–Ω–Ω—ã–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã
  ‚Ä¢ –° SERP –¥–∞–Ω–Ω—ã–º–∏: 56923
  ‚Ä¢ –° offer_info: 42156

4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Master DB...
üíæ Master DB: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ 56923 –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –≥—Ä—É–ø–ø—ã '–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ'

‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!
  ‚Ä¢ –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: 56,923
  ‚Ä¢ –° –∏–Ω—Ç–µ–Ω—Ç–æ–º: 56,923
  ‚Ä¢ –° SERP: 56,923
  ‚Ä¢ –°—Ä–µ–¥–Ω–∏–π offer_ratio: 68%
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚ö°

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (—Å–æ–∑–¥–∞–Ω–∏–µ Master DB)

| –≠—Ç–∞–ø | –í—Ä–µ–º—è | –ö—ç—à–∏—Ä—É–µ—Ç—Å—è? |
|------|-------|-------------|
| CSV –∑–∞–≥—Ä—É–∑–∫–∞ | 2 —Å–µ–∫ | ‚ùå |
| –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ | 30 —Å–µ–∫ | ‚úÖ query_cache |
| –ò–Ω—Ç–µ–Ω—Ç | 9 –º–∏–Ω | ‚úÖ query_cache |
| SERP –∞–Ω–∞–ª–∏–∑ | 5-30 –º–∏–Ω | ‚úÖ serp_data.db |
| –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è | 2 –º–∏–Ω | ‚ùå |
| –ú–µ—Ç—Ä–∏–∫–∏ | 10 —Å–µ–∫ | ‚ùå |
| **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Master DB** | **5 —Å–µ–∫** | **‚úÖ master_queries.db** |
| –≠–∫—Å–ø–æ—Ä—Ç | 20 —Å–µ–∫ | ‚ùå |
| **–ò–¢–û–ì–û** | **16-45 –º–∏–Ω** | - |

### –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã)

| –≠—Ç–∞–ø | –í—Ä–µ–º—è | –û—Ç–∫—É–¥–∞ |
|------|-------|--------|
| **–ó–∞–≥—Ä—É–∑–∫–∞ Master DB** | **3 —Å–µ–∫** | **master_queries.db** ‚úÖ |
| –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è (–Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã) | 30 —Å–µ–∫ | –ü–µ—Ä–µ—Å—á–µ—Ç |
| –ú–µ—Ç—Ä–∏–∫–∏ | 10 —Å–µ–∫ | –ü–µ—Ä–µ—Å—á–µ—Ç |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Master DB | 5 —Å–µ–∫ | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ |
| –≠–∫—Å–ø–æ—Ä—Ç | 20 —Å–µ–∫ | –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ |
| **–ò–¢–û–ì–û** | **~1 –º–∏–Ω** | - |

**–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏: 15-44 –º–∏–Ω—É—Ç—ã –Ω–∞ –∫–∞–∂–¥—ã–π —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç!** üöÄ

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î —Ñ–∞–π–ª–æ–≤ üìÅ

```
output/
‚îú‚îÄ‚îÄ serp_data.db           # SERP XML –æ—Ç xmlstock (2 GB)
‚îú‚îÄ‚îÄ query_cache.db         # –ò–Ω—Ç–µ–Ω—Ç, normalized, NER (50 MB)
‚îî‚îÄ‚îÄ master_queries.db      # –í–°–Å –í –û–î–ù–û–ô –¢–ê–ë–õ–ò–¶–ï! (200 MB) ‚≠ê
    ‚îú‚îÄ‚îÄ –ò–Ω—Ç–µ–Ω—Ç (–∏–∑ query_cache)
    ‚îú‚îÄ‚îÄ SERP top_urls (–ø–∞—Ä—Å–∏–Ω–≥ XML)
    ‚îú‚îÄ‚îÄ SERP offer_info (–ø–∞—Ä—Å–∏–Ω–≥ XML)
    ‚îú‚îÄ‚îÄ LSI phrases (–ø–∞—Ä—Å–∏–Ω–≥ XML)
    ‚îú‚îÄ‚îÄ Yandex Direct (CPC, CTR)
    ‚îú‚îÄ‚îÄ –ú–µ—Ç—Ä–∏–∫–∏ (KEI, difficulty)
    ‚îî‚îÄ‚îÄ –ë—Ä–µ–Ω–¥—ã + –í–æ—Ä–æ–Ω–∫–∞
```

## –ß—Ç–æ –ù–ï —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Master DB ‚ùå

**–ö–ª–∞—Å—Ç–µ—Ä—ã** - –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:
- `semantic_cluster_id`
- `cluster_name`
- `hierarchical_level1/2/3`
- `topic_id`

–ö–ª–∞—Å—Ç–µ—Ä—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ!

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã üîç

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Master DB —Å–æ–∑–¥–∞–Ω–∞

```bash
dir output\master_queries.db
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

```python
from seo_analyzer.core.cache.master_query_db import MasterQueryDatabase

db = MasterQueryDatabase()
stats = db.get_statistics("–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ")

print(stats)
# {
#     'total_queries': 56923,
#     'with_intent': 56923,
#     'with_serp': 56923,
#     'with_direct': 45123,
#     'avg_kei': 125.45,
#     'avg_offer_ratio': 0.68
# }
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```bash
python check_db_performance.py
```

## Troubleshooting üîß

### Master DB –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è?

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ pipeline –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é:
```bash
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –∫–æ–Ω—Ü–µ:
üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Master Query Database
‚úì –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: 56,923
```

### –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö –ë–î:
```bash
dir output\serp_data.db
dir output\query_cache.db
```

### –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Master DB –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ CSV –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è:
```python
from seo_analyzer.core.cache import QueryCacheDatabase

cache = QueryCacheDatabase()
is_changed = cache.is_csv_changed("–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ", "semantika/–≤–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ.csv")

print(f"CSV –∏–∑–º–µ–Ω–∏–ª—Å—è: {is_changed}")
# False = –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–∑ Master DB
# True = –±—É–¥–µ—Ç –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
```

## –°–º. —Ç–∞–∫–∂–µ üìö

- [MASTER_QUERY_DATABASE_SUMMARY.md](MASTER_QUERY_DATABASE_SUMMARY.md) - –û–ø–∏—Å–∞–Ω–∏–µ Master DB
- [DATABASE_INDEXES_GUIDE.md](DATABASE_INDEXES_GUIDE.md) - –ò–Ω–¥–µ–∫—Å—ã –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- [INTENT_CACHE.md](INTENT_CACHE.md) - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–Ω—Ç–∞

---

**–í–æ–ø—Ä–æ—Å—ã?** –ó–∞–ø—É—Å—Ç–∏—Ç–µ `python main.py` –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏!

