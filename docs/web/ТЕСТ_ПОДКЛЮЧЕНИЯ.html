<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è - SEO Cluster Manager</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .container {
      max-width: 800px;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    h1 {
      color: #667eea;
      text-align: center;
      margin-bottom: 30px;
    }

    .test-item {
      background: #f8f9fa;
      padding: 20px;
      margin: 15px 0;
      border-radius: 10px;
      border-left: 5px solid #ddd;
    }

    .test-item.success {
      border-left-color: #28a745;
      background: #d4edda;
    }

    .test-item.error {
      border-left-color: #dc3545;
      background: #f8d7da;
    }

    .test-item.pending {
      border-left-color: #ffc107;
      background: #fff3cd;
    }

    .test-title {
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 18px;
    }

    .test-desc {
      color: #666;
      font-size: 14px;
    }

    .btn {
      display: block;
      width: 100%;
      background: #667eea;
      color: white;
      padding: 15px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 20px;
      transition: all 0.3s;
    }

    .btn:hover {
      background: #5568d3;
      transform: translateY(-2px);
    }

    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    pre {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 8px;
      overflow-x: auto;
      margin-top: 10px;
      font-size: 13px;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üîç –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h1>

    <div id="test-1" class="test-item pending">
      <div class="test-title">‚è≥ 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞</div>
      <div class="test-desc">–ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–ø—É—â–µ–Ω –ª–∏ PHP —Å–µ—Ä–≤–µ—Ä...</div>
    </div>

    <div id="test-2" class="test-item pending">
      <div class="test-title">‚è≥ 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ API</div>
      <div class="test-desc">–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å api.php...</div>
    </div>

    <div id="test-3" class="test-item pending">
      <div class="test-title">‚è≥ 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</div>
      <div class="test-desc">–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–µ—à–∞...</div>
    </div>

    <div id="test-4" class="test-item pending">
      <div class="test-title">‚è≥ 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä—É–ø–ø</div>
      <div class="test-desc">–ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –≥—Ä—É–ø–ø –∑–∞–ø—Ä–æ—Å–æ–≤...</div>
    </div>

    <button id="retry-btn" class="btn" onclick="runTests()" disabled>
      üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã
    </button>

    <button id="open-btn" class="btn" onclick="openManager()" disabled style="display:none; background: #28a745;">
      ‚úÖ –û—Ç–∫—Ä—ã—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    </button>

    <div id="help" style="margin-top: 30px; display: none;">
      <h3 style="color: #dc3545; margin-bottom: 15px;">‚ùå –ß—Ç–æ –¥–µ–ª–∞—Ç—å?</h3>
      <div style="background: #f8d7da; padding: 20px; border-radius: 10px;">
        <p style="margin-bottom: 15px;"><strong>–°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω!</strong></p>
        <p style="margin-bottom: 10px;">–ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ —Ñ–∞–π–ª–æ–≤:</p>
        <pre>start_manager.bat
–ò–õ–ò
–°–¢–ê–†–¢.bat</pre>
        <p style="margin-top: 15px;">–ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:</p>
        <pre>php -S localhost:8000 index.html</pre>
      </div>
    </div>
  </div>

  <script>
    let testsCompleted = false;

    async function runTests() {
      testsCompleted = false;
      document.getElementById('retry-btn').disabled = true;
      document.getElementById('open-btn').style.display = 'none';
      document.getElementById('help').style.display = 'none';

      // –°–±—Ä–æ—Å –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
      for (let i = 1; i <= 4; i++) {
        const elem = document.getElementById(`test-${i}`);
        elem.className = 'test-item pending';
        elem.innerHTML = `
                    <div class="test-title">‚è≥ ${i}. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è...</div>
                    <div class="test-desc"><span class="loading"></span></div>
                `;
      }

      // –¢–µ—Å—Ç 1: –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞
      try {
        const response = await fetch('index.html');
        if (response.ok) {
          updateTest(1, 'success', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞', '–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω ‚úÖ');
        } else {
          throw new Error('–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
        }
      } catch (error) {
        updateTest(1, 'error', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞',
          '–°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω! –ó–∞–ø—É—Å—Ç–∏—Ç–µ start_manager.bat');
        showHelp();
        return;
      }

      // –¢–µ—Å—Ç 2: API
      try {
        const response = await fetch('api.php?action=get_cache_stats');
        if (response.ok) {
          updateTest(2, 'success', '–ü—Ä–æ–≤–µ—Ä–∫–∞ API', 'API —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ');
        } else {
          throw new Error('API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
        }
      } catch (error) {
        updateTest(2, 'error', '–ü—Ä–æ–≤–µ—Ä–∫–∞ API',
          'API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ api.php');
        showHelp();
        return;
      }

      // –¢–µ—Å—Ç 3: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
      try {
        const response = await fetch('api.php?action=get_cache_stats');
        const data = await response.json();

        if (data.exists) {
          updateTest(3, 'success', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö',
            `–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–π–¥–µ–Ω–∞ ‚úÖ<br>
                        –ó–∞–ø—Ä–æ—Å–æ–≤: ${data.queries || 0}<br>
                        –î–æ–∫—É–º–µ–Ω—Ç–æ–≤: ${data.documents || 0}<br>
                        –†–∞–∑–º–µ—Ä: ${data.size_human || '0 B'}`);
        } else {
          updateTest(3, 'success', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö',
            '–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ ‚ÑπÔ∏è');
        }
      } catch (error) {
        updateTest(3, 'error', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö',
          '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: ' + error.message);
      }

      // –¢–µ—Å—Ç 4: –ì—Ä—É–ø–ø—ã
      try {
        const response = await fetch('api.php?action=list_groups');
        const groups = await response.json();

        if (groups && groups.length > 0) {
          updateTest(4, 'success', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä—É–ø–ø',
            `–ù–∞–π–¥–µ–Ω–æ –≥—Ä—É–ø–ø: ${groups.length} ‚úÖ<br>
                        ${groups.map(g => `‚Ä¢ ${g.name} (${g.queries} –∑–∞–ø—Ä–æ—Å–æ–≤)`).join('<br>')}`);
        } else {
          updateTest(4, 'success', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä—É–ø–ø',
            '–ì—Ä—É–ø–ø –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚ÑπÔ∏è');
        }
      } catch (error) {
        updateTest(4, 'error', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä—É–ø–ø',
          '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≥—Ä—É–ø–ø: ' + error.message);
      }

      // –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
      testsCompleted = true;
      document.getElementById('retry-btn').disabled = false;
      document.getElementById('open-btn').style.display = 'block';
    }

    function updateTest(num, status, title, desc) {
      const elem = document.getElementById(`test-${num}`);
      elem.className = `test-item ${status}`;

      const icon = status === 'success' ? '‚úÖ' : status === 'error' ? '‚ùå' : '‚è≥';

      elem.innerHTML = `
                <div class="test-title">${icon} ${num}. ${title}</div>
                <div class="test-desc">${desc}</div>
            `;
    }

    function showHelp() {
      document.getElementById('help').style.display = 'block';
      document.getElementById('retry-btn').disabled = false;
    }

    function openManager() {
      window.location.href = 'index.html';
    }

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    window.addEventListener('load', () => {
      setTimeout(runTests, 500);
    });
  </script>
</body>

</html>