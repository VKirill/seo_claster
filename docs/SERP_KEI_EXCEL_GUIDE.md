# üöÄ SERP, LSI, KEI, Excel - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## üìã –û–±–∑–æ—Ä

–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ SEO –∞–Ω–∞–ª–∏–∑–∞ –≤–∫–ª—é—á–∞–µ—Ç:

1. **SERP –∞–Ω–∞–ª–∏–∑** —á–µ—Ä–µ–∑ xmlstock API (TOP-30, lr=213 –ú–æ—Å–∫–≤–∞)
2. **LSI —Ñ—Ä–∞–∑—ã** –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, —Å–Ω–∏–ø–ø–µ—Ç–æ–≤, –ø–∞—Å—Å–∞–∂–µ–π
3. **18 KEI —Ñ–æ—Ä–º—É–ª** –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
4. **Excel —ç–∫—Å–ø–æ—Ä—Ç** —Å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º, –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π, —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
5. **SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è SERP –¥–∞–Ω–Ω—ã—Ö
6. **Soft topic clustering** –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
7. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≥–µ–æ-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è** —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º Russian.txt

## üóÑÔ∏è SQLite –ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö

### –ó–∞—á–µ–º?

SQLite –±–∞–∑–∞ —Ö—Ä–∞–Ω–∏—Ç **–≤—Å–µ** –¥–∞–Ω–Ω—ã–µ –∏–∑ xmlstock:
- XML –æ—Ç–≤–µ—Ç—ã —Ü–µ–ª–∏–∫–æ–º
- –ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (docs_count, main_pages, titles)
- –°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (URL, title, snippet, passages)
- LSI —Ñ—Ä–∞–∑—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ API –ø—Ä–∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞—Ö –∫–æ–¥–∞
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã –≤–º–µ—Å—Ç–æ —Å–µ–∫—É–Ω–¥)
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ñ–æ—Ä–º—É–ª–∞–º–∏ KEI –±–µ–∑ –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å timestamp
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö (TTL 30 –¥–Ω–µ–π)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î

**–§–∞–π–ª:** `output/serp_data.db`

**–¢–∞–±–ª–∏—Ü—ã:**
1. `serp_results` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã SERP
2. `serp_documents` - –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ TOP-30
3. `lsi_phrases` - LSI —Ñ—Ä–∞–∑—ã

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**

```python
from seo_analyzer.core.serp_database import SERPDatabase

db = SERPDatabase()

# –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
data = db.get_serp_data("–∫—É–ø–∏—Ç—å —Å–∫—É–¥", lr=213)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
stats = db.get_statistics()
print(f"–ó–∞–ø—Ä–æ—Å–æ–≤ –≤ –ë–î: {stats['total_queries']}")
print(f"–†–∞–∑–º–µ—Ä –ë–î: {stats['db_size_mb']} MB")

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö (>30 –¥–Ω–µ–π)
deleted = db.clear_old_data(days=30)
```

## üîç SERP –ê–Ω–∞–ª–∏–∑

### –ó–∞–ø—É—Å–∫ —Å SERP

```bash
python main.py semantika/—Å–∫—É–¥.csv \
  --xmlstock-api-key your_user:your_key \
  --enable-serp \
  --max-serp-queries 500
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è SQLite –ë–î
   - –ó–∞—Ç–µ–º —Ñ–∞–π–ª–æ–≤—ã–π –∫—ç—à (`output/serp_cache/`)
   - –¢–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –∑–∞–ø—Ä–æ—Å –∫ API

2. **–ò–∑–≤–ª–µ–∫–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ:**
   - `<found>` - –Ω–∞–π–¥–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–¥–ª—è KEI)
   - `<grouping><group>` - –≥–ª–∞–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ TOP
   - –ü–æ–∏—Å–∫ –ö–° –≤ `<title>` - —Ç–æ—á–Ω—ã–µ –≤—Ö–æ–∂–¥–µ–Ω–∏—è
   - –ü–æ–¥—Å—á–µ—Ç –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö/–∏–Ω—Ñ–æ –¥–æ–º–µ–Ω–æ–≤
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ title, snippet, passages –¥–ª—è LSI

3. **LSI —Ñ—Ä–∞–∑—ã:**
   - N-–≥—Ä–∞–º–º—ã (2-4 —Å–ª–æ–≤–∞) –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤ SERP
   - –õ–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ pymorphy3
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç–æ–ø-—Å–ª–æ–≤
   - –¢–æ–ø-10 —Ñ—Ä–∞–∑ –Ω–∞ –∑–∞–ø—Ä–æ—Å –ø–æ —á–∞—Å—Ç–æ—Ç–µ

### –†–µ–∑—É–ª—å—Ç–∞—Ç

–ù–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ CSV:
- `serp_docs_count` - –Ω–∞–π–¥–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `serp_main_pages` - –≥–ª–∞–≤–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- `serp_titles_count` - title —Å –ö–°
- `serp_commercial_domains` - –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –¥–æ–º–µ–Ω–æ–≤
- `serp_info_domains` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- `lsi_phrases` - —Å–ø–∏—Å–æ–∫ LSI —Ñ—Ä–∞–∑ (JSON)

## üìä KEI –ú–µ—Ç—Ä–∏–∫–∏ (18 —Ñ–æ—Ä–º—É–ª)

### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏

#### 1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ KEI (3 —Ñ–æ—Ä–º—É–ª—ã)

```python
# KEI Standard
kei_standard = (Freq / 2)¬≤ / Competition

# KEI Devaka (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ—Å—Ç—å)
kei_devaka = (ExactFreq * 3 + BaseFreq) / BaseFreq

# Base/Exact Ratio (—à–∏—Ä–æ—Ç–∞)
kei_base_exact_ratio = BaseFreq / ExactFreq
```

#### 2. Soltyk KEI (9 —Ñ–æ—Ä–º—É–ª)

```python
# 1. Competition (–º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å)
kei_competition = ((1 + MainPages*2 + TitlesCount) * (DocsCount / ExactFreq)) / (1 + ExactFreq/12)

# 2. Effectiveness (–º–∞–∫—Å–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å)
kei_effectiveness = ((ExactFreq / 12) + ExactFreq) / (2 + MainPages + TitlesCount)

# 3. Coefficient
kei_coefficient = ExactFreq / (MainPages + TitlesCount + 1)

# 4. Popularity
kei_popularity = (BaseFreq + ExactFreq * 2) / 3

# 5. Potential Traffic
kei_potential_traffic = (ExactFreq * 0.3) + (BaseFreq * 0.1)

# 6-9. Cost, Revenue, Synergy, Relevance
# ... (—Å–º. seo_metrics_calculator.py)
```

#### 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (3 —Ñ–æ—Ä–º—É–ª—ã)

```python
# CTR Potential
ctr_potential = (ExactFreq / BaseFreq) * 100

# Commercial Value
commercial_value = Freq * CommercialScore * (1+isGeo) * (1+isBrand)

# Priority Score (–∏—Ç–æ–≥–æ–≤—ã–π)
priority_score = weighted_sum(
    freq_normalized * 0.3,
    (100 - difficulty) * 0.25,
    commercial_normalized * 0.25,
    kei_eff_normalized * 0.20
)
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–µ–∑ SERP

–ï—Å–ª–∏ –Ω–µ—Ç API –∫–ª—é—á–∞, KEI –≤—Å–µ —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å **–æ—Ü–µ–Ω–æ—á–Ω—ã–º–∏** –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:

```python
python main.py semantika/—Å–∫—É–¥.csv --enable-kei
# –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: serp_docs_count = freq * 1000
```

## üî§ LSI –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ –∫–ª–∞—Å—Ç–µ—Ä–∞–º

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç?

–°–æ–±–∏—Ä–∞–µ—Ç LSI —Ñ—Ä–∞–∑—ã –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–ø-10 —Å–∞–º—ã—Ö —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö:

```python
# –î–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞ "—Å–∏—Å—Ç–µ–º—ã —Å–∫—É–¥"
cluster_lsi_phrases = [
  "—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã",
  "–∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞",
  "—Ç—É—Ä–Ω–∏–∫–µ—Ç—ã –æ–≥—Ä–∞–∂–¥–µ–Ω–∏—è",
  "–±–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å",
  ...
]
```

### –≠–∫—Å–ø–æ—Ä—Ç

**–§–∞–π–ª:** `output/cluster_lsi_phrases.csv`

–ö–æ–ª–æ–Ω–∫–∏:
- `cluster_id`
- `phrase`
- `frequency` - —Å—É–º–º–∞ —á–∞—Å—Ç–æ—Ç –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ
- `queries_count` - –≤ —Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è
- `main_source` - –æ—Ç–∫—É–¥–∞ —á–∞—â–µ (title/snippet/passages)
- `relevance_score` - –∏—Ç–æ–≥–æ–≤–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å

### –í –æ—Å–Ω–æ–≤–Ω–æ–º CSV

–ö–æ–ª–æ–Ω–∫–∞ `cluster_lsi_phrases` - —Ç–æ–ø-5 —Ñ—Ä–∞–∑ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é:

```csv
query,cluster_lsi_phrases
"—Å–∏—Å—Ç–µ–º–∞ —Å–∫—É–¥","—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã, –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞, —Ç—É—Ä–Ω–∏–∫–µ—Ç—ã..."
```

## üìà Excel –≠–∫—Å–ø–æ—Ä—Ç

### –ó–∞–ø—É—Å–∫

```bash
python main.py semantika/—Å–∫—É–¥.csv --enable-serp --xmlstock-api-key user:key
# Excel —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: output/seo_analysis.xlsx

# –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å Excel
python main.py semantika/—Å–∫—É–¥.csv --skip-excel

# –° –≥—Ä–∞—Ñ–∏–∫–∞–º–∏ (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ)
python main.py semantika/—Å–∫—É–¥.csv --excel-with-charts
```

### –õ–∏—Å—Ç—ã –≤ Excel

#### –õ–∏—Å—Ç 1: All Queries
- **–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã** —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
- **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞** –ø–æ –∫–ª–∞—Å—Ç–µ—Ä–∞–º (—Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã–µ +/- –≥—Ä—É–ø–ø—ã)
- **–£—Å–ª–æ–≤–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
  - üü¢ –ó–µ–ª–µ–Ω—ã–π = –≤—ã—Å–æ–∫–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
  - üî¥ –ö—Ä–∞—Å–Ω—ã–π = –≤—ã—Å–æ–∫–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è
- **–ê–≤—Ç–æ—Ñ–∏–ª—å—Ç—Ä—ã** –Ω–∞ –≤—Å–µ—Ö –∫–æ–ª–æ–Ω–∫–∞—Ö
- **–ó–∞–º–æ—Ä–æ–∂–µ–Ω–Ω–∞—è** –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞

#### –õ–∏—Å—Ç 2: Top Priority
- –¢–æ–ø-100 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ `priority_score`
- –°–∞–º—ã–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –¥–ª—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è

#### –õ–∏—Å—Ç 3: Clusters Summary
- –°–≤–æ–¥–∫–∞ –ø–æ –∫–ª–∞—Å—Ç–µ—Ä–∞–º:
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
  - –°—É–º–º–∞—Ä–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞
  - –°—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å
  - –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ–Ω—Ç
  - –ì–ª–∞–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫–ª–∞—Å—Ç–µ—Ä–∞

#### –õ–∏—Å—Ç 4: Intent Summary
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∏–Ω—Ç–µ–Ω—Ç–∞–º
- Commercial / Informational / Navigational / Transactional

#### –õ–∏—Å—Ç 5: LSI Phrases
- –í—Å–µ LSI —Ñ—Ä–∞–∑—ã –∫–ª–∞—Å—Ç–µ—Ä–æ–≤
- –¢–æ–ø-10 –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¶–≤–µ—Ç–æ–≤—ã–µ —à–∫–∞–ª—ã:**

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–≤–µ—Ç | –õ–æ–≥–∏–∫–∞ |
|---------|------|--------|
| `kei_effectiveness` | üü¢‚Üíüü°‚Üíüî¥ | –ë–æ–ª—å—à–µ = –ª—É—á—à–µ |
| `kei_competition` | üî¥‚Üíüü°‚Üíüü¢ | –ë–æ–ª—å—à–µ = —Ö—É–∂–µ |
| `difficulty_score` | üî¥‚Üíüü°‚Üíüü¢ | –ë–æ–ª—å—à–µ = —Å–ª–æ–∂–Ω–µ–µ |
| `frequency` | ‚ö™‚Üíüü¢ | –ì—Ä–∞–¥–∏–µ–Ω—Ç |

## üåç –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≥–µ–æ-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞

–†–∞–Ω—å—à–µ:
```
"—Å–∏—Å—Ç–µ–º—ã —Å–∫—É–¥ —Ä–æ—Å—Ç–æ–≤" ‚Üí –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–ª—Å—è –∫–∞–∫ geo
```

### –†–µ—à–µ–Ω–∏–µ

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –ø–æ–∏—Å–∫–∞:

1. **Russian.txt** - –≥–æ—Ä–æ–¥–∞ –†–§ (—Å –≥—Ä–∞–Ω–∏—Ü–∞–º–∏ —Å–ª–æ–≤ `\b`)
2. **Moscow.txt** - –≤–∞—Ä–∏–∞–Ω—Ç—ã –ú–æ—Å–∫–≤—ã
3. **Kazakhstan/Belarus/Ukraine** - –¥—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω—ã
4. **Country** - –æ–±—â–∏–µ —Ç–µ—Ä–º–∏–Ω—ã

```python
# –¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:
"—Å–∏—Å—Ç–µ–º—ã —Å–∫—É–¥ —Ä–æ—Å—Ç–æ–≤ –Ω–∞ –¥–æ–Ω—É" ‚Üí commercial, geo_city="–†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É"
"—Å–∫—É–¥ –º–æ—Å–∫–≤–∞" ‚Üí commercial, geo_city="–ú–æ—Å–∫–≤–∞"
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- ‚úÖ –ì–µ–æ-–∑–∞–ø—Ä–æ—Å—ã **–≤—Å–µ–≥–¥–∞** commercial (intent)
- ‚úÖ `has_geo=True`
- ‚úÖ `geo_city` –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ `detected_location` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–π–¥–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç

## üé≠ Soft Topic Clustering

### –ß—Ç–æ —ç—Ç–æ?

**Hard clustering:** 1 –∑–∞–ø—Ä–æ—Å = 1 —Ç–µ–º–∞

**Soft clustering:** 1 –∑–∞–ø—Ä–æ—Å = –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ–º (—Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏)

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
python main.py semantika/—Å–∫—É–¥.csv --soft-clustering
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç

–ù–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏:
- `topic_id` - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–µ–º–∞ (–∫–∞–∫ —Ä–∞–Ω—å—à–µ)
- `topic_probability` - –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–º—ã
- `all_topics` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–µ–º: `[(0, 0.45), (3, 0.30), (7, 0.15)]`
- `all_topics_str` - –¥–ª—è CSV: `"T0(0.45), T3(0.30), T7(0.15)"`

**–ü—Ä–∏–º–µ—Ä:**

```
–ó–∞–ø—Ä–æ—Å: "—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç—É—Ä–Ω–∏–∫–µ—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞"

Hard clustering:
topic_id=0 (—Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è)

Soft clustering:
topic_id=0 (—Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è, 0.45)
all_topics=[
  (0, 0.45),  # —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è
  (3, 0.30),  # —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è
  (7, 0.15)   # —Ç—É—Ä–Ω–∏–∫–µ—Ç—ã
]
```

## üîß –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ API)

```bash
python main.py semantika/—Å–∫—É–¥.csv
```

### –° SERP –∏ KEI

```bash
python main.py semantika/—Å–∫—É–¥.csv \
  --xmlstock-api-key myuser:abc123def456 \
  --enable-serp \
  --max-serp-queries 500 \
  --soft-clustering
```

### –ü–æ–ª–Ω—ã–π pipeline

```bash
python main.py semantika/—Å–∫—É–¥.csv \
  --xmlstock-api-key myuser:abc123def456 \
  --enable-serp \
  --enable-kei \
  --max-serp-queries 500 \
  --soft-clustering \
  --excel-with-charts \
  --enable-graph
```

## üìÅ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –≤ output/

–ü–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:

```
output/
‚îú‚îÄ‚îÄ serp_data.db                    # SQLite –ë–î —Å–æ –≤—Å–µ–º–∏ SERP –¥–∞–Ω–Ω—ã–º–∏
‚îú‚îÄ‚îÄ serp_cache/                     # –§–∞–π–ª–æ–≤—ã–π –∫—ç—à (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π)
‚îÇ   ‚îî‚îÄ‚îÄ ab/abc123def456.json
‚îú‚îÄ‚îÄ seo_analysis.xlsx               # üìä Excel —Å 5 –ª–∏—Å—Ç–∞–º–∏
‚îú‚îÄ‚îÄ seo_analysis_full.csv           # –ü–æ–ª–Ω—ã–π CSV —Å KEI –º–µ—Ç—Ä–∏–∫–∞–º–∏
‚îú‚îÄ‚îÄ cluster_lsi_phrases.csv         # LSI —Ñ—Ä–∞–∑—ã –ø–æ –∫–ª–∞—Å—Ç–µ—Ä–∞–º
‚îú‚îÄ‚îÄ seo_analysis_top1000.csv
‚îú‚îÄ‚îÄ clusters_summary.csv
‚îú‚îÄ‚îÄ brands.csv
‚îú‚îÄ‚îÄ dashboard.html
‚îî‚îÄ‚îÄ statistics.json
```

## üéØ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –¥–ª—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è

### –¢–æ–ø –∑–∞–ø—Ä–æ—Å—ã –ø–æ priority_score

```sql
SELECT query, frequency_world, difficulty_score, priority_score, kei_effectiveness
FROM queries
ORDER BY priority_score DESC
LIMIT 100
```

**–í Excel:** –ª–∏—Å—Ç "Top Priority"

### –§–æ—Ä–º—É–ª–∞ priority_score

```
priority_score = 
  normalized(frequency) * 0.3 +
  (100 - difficulty) * 0.25 +
  normalized(commercial_score) * 0.25 +
  normalized(kei_effectiveness) * 0.20
```

**–§–∞–∫—Ç–æ—Ä—ã:**
- 30% - —á–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç—å (—á–µ–º –±–æ–ª—å—à–µ = –ª—É—á—à–µ)
- 25% - —Å–ª–æ–∂–Ω–æ—Å—Ç—å (—á–µ–º –º–µ–Ω—å—à–µ = –ª—É—á—à–µ)
- 25% - –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å
- 20% - KEI —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

## üö¶ –°—Ç–∞—Ç—É—Å—ã –∏ –ª–æ–≥–∏

### SERP –∞–Ω–∞–ª–∏–∑

```
üîç –≠–¢–ê–ü 4.5: SERP –∞–Ω–∞–ª–∏–∑
--------------------------------------------------------------------------------
üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SERP –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞...
üìä –ê–Ω–∞–ª–∏–∑ SERP –¥–ª—è 500 —Ç–æ–ø –∑–∞–ø—Ä–æ—Å–æ–≤...
  [10/500] —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º...
  [20/500] –∫—É–ø–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Å–∫—É–¥...
  ...
‚úì SERP –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω:
  –í—Å–µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤: 500
  –ò–∑ –∫—ç—à–∞ (–ë–î): 350
  –ò–∑ –∫—ç—à–∞ (—Ñ–∞–π–ª): 50
  API –∑–∞–ø—Ä–æ—Å–æ–≤: 100
  –û—à–∏–±–æ–∫: 0
  Cache hit rate: 80.00%
```

### KEI —Ä–∞—Å—á–µ—Ç

```
üìä –≠–¢–ê–ü 4.6: –†–∞—Å—á–µ—Ç SEO –º–µ—Ç—Ä–∏–∫
--------------------------------------------------------------------------------
  üìä –†–∞—Å—á–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö KEI —Ñ–æ—Ä–º—É–ª...
  üìä –†–∞—Å—á–µ—Ç Soltyk KEI —Ñ–æ—Ä–º—É–ª...
  üìä –†–∞—Å—á–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫...
‚úì –†–∞—Å—Å—á–∏—Ç–∞–Ω–æ –º–µ—Ç—Ä–∏–∫: 15
  –°—Ä–µ–¥–Ω–∏–π KEI effectiveness: 45.23
  –°—Ä–µ–¥–Ω–∏–π priority_score: 67.89
```

### LSI –∞–≥—Ä–µ–≥–∞—Ü–∏—è

```
üî§ –≠–¢–ê–ü 4.7: –ê–≥—Ä–µ–≥–∞—Ü–∏—è LSI —Ñ—Ä–∞–∑
--------------------------------------------------------------------------------
üîÑ –ê–≥—Ä–µ–≥–∞—Ü–∏—è LSI —Ñ—Ä–∞–∑ –ø–æ –∫–ª–∞—Å—Ç–µ—Ä–∞–º...
‚úì LSI –∞–≥—Ä–µ–≥–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞:
  –ö–ª–∞—Å—Ç–µ—Ä–æ–≤: 89
  –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ñ—Ä–∞–∑: 890
  –°—Ä–µ–¥–Ω–µ–µ —Ñ—Ä–∞–∑/–∫–ª–∞—Å—Ç–µ—Ä: 10.0
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### config.py - –Ω–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```python
# SERP
SERP_CONFIG = {
    "enabled": False,  # –ù—É–∂–µ–Ω API –∫–ª—é—á
    "cache_ttl_days": 30,
    "max_queries_to_analyze": 500,
    "api": {
        "lr": 213,  # –ú–æ—Å–∫–≤–∞
        "groupby": "attr=d.mode=deep.groups-on-page=30.docs-in-group=1",
        "max_concurrent": 5,
    }
}

# LSI
LSI_CONFIG = {
    "ngram_range": (2, 4),
    "top_n_per_query": 10,
    "top_n_per_cluster": 10,
    "min_phrase_frequency": 2,
}

# KEI
KEI_CONFIG = {
    "enabled_formulas": [...],  # 15+ —Ñ–æ—Ä–º—É–ª
    "yandex_direct_integration": False,
}

# Excel
EXCEL_CONFIG = {
    "enabled": True,
    "group_by_clusters": True,
    "conditional_formatting": True,
    "freeze_panes": True,
    "auto_filter": True,
}
```

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "API key required"

```bash
# –ù—É–∂–µ–Ω —Ñ–ª–∞–≥ --enable-serp –ò --xmlstock-api-key
python main.py data.csv --enable-serp --xmlstock-api-key user:key
```

### –ë–î —Ä–∞—Å—Ç–µ—Ç —Å–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä–æ

```python
from seo_analyzer.core.serp_database import SERPDatabase

db = SERPDatabase()
# –£–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ 15 –¥–Ω–µ–π
db.clear_old_data(days=15)
```

### Excel –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `xlsxwriter` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `pip install xlsxwriter`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--skip-excel` –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–µ–Ω

### Slow SERP requests

```python
# –£–≤–µ–ª–∏—á—å—Ç–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å –≤ config.py
SERP_CONFIG["api"]["max_concurrent"] = 10  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 5
```

## üìö API Reference

### SERPDatabase

```python
db = SERPDatabase(db_path="output/serp_data.db")

# –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
data = db.get_serp_data(query, lr=213, max_age_days=30)

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
db.save_serp_data(query, lr, xml_response, metrics, documents, lsi_phrases)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
stats = db.get_statistics()

# –û—á–∏—Å—Ç–∫–∞
deleted = db.clear_old_data(days=30)

# –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
db.export_to_json(Path("backup.json"))
```

### SEOMetricsCalculator

```python
from seo_analyzer.metrics.seo_metrics_calculator import SEOMetricsCalculator

calc = SEOMetricsCalculator()

# –†–∞—Å—á–µ—Ç –≤—Å–µ—Ö –º–µ—Ç—Ä–∏–∫
df = calc.calculate_all_metrics(df)

# –¢–æ–ø –∑–∞–ø—Ä–æ—Å—ã –ø–æ –º–µ—Ç—Ä–∏–∫–µ
top = calc.get_top_queries_by_metric(df, metric='priority_score', top_n=100)

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
summary = calc.get_metrics_summary(df)
```

### ExcelExporter

```python
from seo_analyzer.export.excel_exporter import ExcelExporter

exporter = ExcelExporter()

exporter.export_to_excel(
    df,
    output_path=Path("output/seo_analysis.xlsx"),
    include_charts=False,
    group_by_clusters=True
)
```

## üéì Best Practices

### 1. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
# –°–Ω–∞—á–∞–ª–∞ –±–µ–∑ SERP (–±—ã—Å—Ç—Ä–æ)
python main.py data.csv

# –ü–æ—Ç–æ–º –¥–æ–±–∞–≤–∏—Ç—å SERP –¥–ª—è —Ç–æ–ø–∞
python main.py data.csv \
  --xmlstock-api-key user:key \
  --enable-serp \
  --max-serp-queries 100

# –ó–∞—Ç–µ–º —Ä–∞—Å—à–∏—Ä–∏—Ç—å
python main.py data.csv \
  --xmlstock-api-key user:key \
  --enable-serp \
  --max-serp-queries 500
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞

–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ —Å —Ç–µ–º –∂–µ —Ñ–∞–π–ª–æ–º - **–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ** (–∏–∑ –ë–î):

```bash
# –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ - –¥–µ–ª–∞–µ—Ç API –∑–∞–ø—Ä–æ—Å—ã
python main.py data.csv --enable-serp --xmlstock-api-key user:key

# –í—Ç–æ—Ä–æ–π –∑–∞–ø—É—Å–∫ - –∏–∑ –ë–î (—Å–µ–∫—É–Ω–¥—ã –≤–º–µ—Å—Ç–æ –º–∏–Ω—É—Ç)
python main.py data.csv --enable-serp --xmlstock-api-key user:key
```

### 3. –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å KEI

```python
# –ò–∑–º–µ–Ω—è–π—Ç–µ –≤–µ—Å–∞ priority_score –≤ config.py
priority_weights = {
    'frequency': 0.4,      # –ë—ã–ª–æ 0.3
    'difficulty': 0.2,     # –ë—ã–ª–æ 0.25
    'commercial': 0.2,     # –ë—ã–ª–æ 0.25
    'kei_effectiveness': 0.2  # –ë—ã–ª–æ 0.20
}
```

–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–π—Ç–µ –±–µ–∑ `--enable-serp` - –¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤ –ë–î!

### 4. –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

1. –û—Ç–∫—Ä–æ–π—Ç–µ `seo_analysis.xlsx`
2. –õ–∏—Å—Ç "Top Priority" - –Ω–∞—á–Ω–∏—Ç–µ —Å —ç—Ç–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
3. –õ–∏—Å—Ç "Clusters Summary" - –≤—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã
4. –õ–∏—Å—Ç "LSI Phrases" - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞

## üí° –ü—Ä–∏–º–µ—Ä—ã use cases

### Use case 1: –ü–æ–∏—Å–∫ –Ω–∏–∑–∫–æ–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

Excel —Ñ–∏–ª—å—Ç—Ä—ã:
- `kei_competition` < 50 (–Ω–∏–∑–∫–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è)
- `frequency_world` > 100 (–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞)
- `priority_score` > 60 (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

### Use case 2: –ö–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏–∑ "Clusters Summary":
1. –í–∑—è—Ç—å `Main Query` - –æ—Å–Ω–æ–≤–∞ —Å—Ç–∞—Ç—å–∏
2. –û—Ç–∫—Ä—ã—Ç—å LSI —Ñ—Ä–∞–∑—ã –∫–ª–∞—Å—Ç–µ—Ä–∞
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ø-10 LSI –∫–∞–∫ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏/–∞–±–∑–∞—Ü—ã

### Use case 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```bash
# –†–∞–∑ –≤ –º–µ—Å—è—Ü
python main.py data.csv --enable-serp --xmlstock-api-key user:key

# –°—Ä–∞–≤–Ω–∏—Ç—å difficulty_score —Å –ø—Ä–æ—à–ª—ã–º –º–µ—Å—è—Ü–µ–º
# –ë–î —Ö—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é —Å timestamp
```

## üìû Support

–í–æ–ø—Ä–æ—Å—ã –∏ —É–ª—É—á—à–µ–Ω–∏—è:
- GitHub Issues
- Telegram: @your_username
- Email: support@example.com

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2025-12-07  
**Python:** 3.14+  
**License:** MIT


