# ๐ฏ ะะปะฐััะธัะธะบะฐัะธั ะฟะพ SERP offer_info (ะฝะฐะธะฑะพะปะตะต ัะพัะฝะฐั)

## ๐ ะัะพะฑะปะตะผะฐ ััะฐัะพะณะพ ะฟะพะดัะพะดะฐ

### โ ะะปะฐััะธัะธะบะฐัะธั ะฟะพ ะดะพะผะตะฝะฐะผ (ะฝะตัะพัะฝะพ):

```python
# ะะพะผะตะฝ bolid.ru ะฐะฝะฐะปะธะทะธััะตััั ะะ ะะกะะ ะทะฐะฟัะพัะฐะผ:
# "ะบัะฟะธัั ัะบัะด" โ bolid.ru ะฟะพะบะฐะทัะฒะฐะตั ัะพะฒะฐัั ั <offer_info>
# "ัััะฐะฝะพะฒะบะฐ ัะบัะด" โ bolid.ru ะฟะพะบะฐะทัะฒะฐะตั ัะพะฒะฐัั ั <offer_info>
# "ัะท ัะบัะด ะฑะพะปะธะด" โ bolid.ru ะฟะพะบะฐะทัะฒะฐะตั PDF ะดะพะบัะผะตะฝัั ะะะ <offer_info>
#
# ะะตะทัะปััะฐั: bolid.ru = commercial (30% ะดะพะบัะผะตะฝัะพะฒ ั offer_info)
# ะะะะะะะะ: "ัะท ัะบัะด ะฑะพะปะธะด" ะฟะพะปััะฐะตั commercial ะพั ะดะพะผะตะฝะฐ (ะะะะะะะะะฌะะ!)
```

---

## โ ะะพะฒัะน ะฟะพะดัะพะด: ะะฝะฐะปะธะท ะะะะะะะขะะะ ะฒัะดะฐัะธ

### ะะดะตั:

**ะกะผะพััะตัั ะฝะต ะฝะฐ ะดะพะผะตะฝั, ะฐ ะฝะฐ `<offer_info>` ะฒ XML ะฒัะดะฐัะต ะดะปั ะะะะะะะ ะทะฐะฟัะพัะฐ ะพัะดะตะปัะฝะพ!**

```python
# ะะฐะฟัะพั: "ัะท ัะบัะด ะฑะพะปะธะด"
# ะะฝะฐะปะธะทะธััะตะผ ะขะะ-20 ะดะพะบัะผะตะฝัะพะฒ ะฒ XML:
# - ะะพะบัะผะตะฝัะพะฒ ั <offer_info>: 0
# - ะัะตะณะพ ะดะพะบัะผะตะฝัะพะฒ: 20
# - ะกะพะพัะฝะพัะตะฝะธะต: 0/20 = 0% < 40%
# โ informational โ
```

```python
# ะะฐะฟัะพั: "ะบัะฟะธัั ัะบัะด"
# ะะฝะฐะปะธะทะธััะตะผ ะขะะ-20 ะดะพะบัะผะตะฝัะพะฒ ะฒ XML:
# - ะะพะบัะผะตะฝัะพะฒ ั <offer_info>: 15
# - ะัะตะณะพ ะดะพะบัะผะตะฝัะพะฒ: 20
# - ะกะพะพัะฝะพัะตะฝะธะต: 15/20 = 75% >= 40%
# โ commercial โ
```

---

## ๐ฏ ะะพะณะธะบะฐ ะบะปะฐััะธัะธะบะฐัะธะธ

### ะะพัะพะณะธ:

```python
TOP_N = 20                    # ะะฝะฐะปะธะทะธััะตะผ ัะพะฟ-20 ะดะพะบัะผะตะฝัะพะฒ
COMMERCIAL_THRESHOLD = 8      # >= 8 ะดะพะบัะผะตะฝัะพะฒ ั offer_info
COMMERCIAL_RATIO = 0.4        # ะธะปะธ >= 40% ะดะพะบัะผะตะฝัะพะฒ
```

### ะะปะณะพัะธัะผ:

```
1. ะะพะปััะธัั XML ะพัะฒะตั ะพั ะฏะฝะดะตะบั ะดะปั ะทะฐะฟัะพัะฐ
   โ
2. ะะทะฒะปะตัั ะขะะ-20 ะณััะฟะฟ (<group>)
   โ
3. ะะพะดััะธัะฐัั ัะบะพะปัะบะพ ะณััะฟะฟ ัะพะดะตัะถะฐั <offer_info>
   โ
4. ะัะปะธ docs_with_offers >= 8 ะะะ ratio >= 0.4:
   โ commercial
   ะะฝะฐัะต:
   โ informational
```

---

## ๐ง ะะตะฐะปะธะทะฐัะธั

### ะะพะฒัะน ะบะปะฐััะธัะธะบะฐัะพั:

**ะคะฐะนะป:** `seo_analyzer/classification/intent/serp_offer_classifier.py`

```python
from seo_analyzer.classification.intent.serp_offer_classifier import SERPOfferClassifier

# ะะฝะธัะธะฐะปะธะทะฐัะธั
classifier = SERPOfferClassifier(
    top_n=20,                    # ะขะะ-20
    commercial_threshold=8,       # >= 8 ะดะพะบัะผะตะฝัะพะฒ
    commercial_ratio=0.4          # ะธะปะธ >= 40%
)

# ะะปะฐััะธัะธะบะฐัะธั ะพะดะฝะพะณะพ ะทะฐะฟัะพัะฐ
intent, confidence, stats = classifier.classify_by_offers(xml_response)

# ะะตะทัะปััะฐั:
# intent: 'commercial' ะธะปะธ 'informational'
# confidence: 0.5 - 1.0
# stats: {
#     'docs_with_offers': 0,
#     'total_docs': 20,
#     'offer_ratio': 0.0
# }
```

### ะะฝัะตะณัะฐัะธั ะฒ ะฟะฐะนะฟะปะฐะนะฝ:

**ะคะฐะนะป:** `pipeline/stages/classifier.py`

```python
# 1. ะะฐะทะพะฒะฐั ะบะปะฐััะธัะธะบะฐัะธั ะฟะพ ะบะปััะตะฒัะผ ัะปะพะฒะฐะผ
intent_results = analyzer.intent_classifier.classify_batch(...)

# 2. ะะะะะะะขะะข: ะะพััะตะบัะธัะพะฒะบะฐ ะฟะพ SERP offer_info
if 'xml_response' in analyzer.df.columns:
    serp_classifier = SERPOfferClassifier()
    serp_results = serp_classifier.classify_batch(xml_list)
    
    # ะะตัะตะทะฐะฟะธััะฒะฐะตะผ main_intent ะตัะปะธ ะตััั SERP ะดะฐะฝะฝัะต
    for idx in analyzer.df.index:
        if analyzer.df.at[idx, 'xml_response']:
            analyzer.df.at[idx, 'main_intent'] = serp_results[idx]['serp_intent']
```

---

## ๐ ะัะธะพัะธัะตั ะผะตัะพะดะพะฒ ะบะปะฐััะธัะธะบะฐัะธะธ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1๏ธโฃ SERP offer_info (HIGHEST)          โ โ ะะพะฒัะน ะผะตัะพะด (ัะพัะฝะตะต ะฒัะตั!)
โ    ะะฝะฐะปะธะท ะบะพะฝะบัะตัะฝะพะน ะฒัะดะฐัะธ            โ
โ    ะัะธะผะตั: 0/20 offer_info โ info      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 2๏ธโฃ ะะปััะตะฒัะต ัะปะพะฒะฐ                      โ
โ    "ัะท", "ะณะพัั", "ะบัะฟะธัั"              โ
โ    ะัะธะผะตั: "ัะท" ะฒ ะทะฐะฟัะพัะต โ info       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 3๏ธโฃ ะะพะผะตะฝั (LOWEST)                     โ
โ    ะะฑัะฐั ััะฐัะธััะธะบะฐ ะฟะพ ะดะพะผะตะฝั          โ
โ    ะัะธะผะตั: bolid.ru โ commercial       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะัะฐะฒะธะปะพ:** ะัะปะธ ะตััั SERP XML ะดะฐะฝะฝัะต โ ะพะฝะธ ะะะะะะะะะกะซะะะฎะข ัะตะทัะปััะฐั ะบะปััะตะฒัั ัะปะพะฒ!

---

## ๐ ะะตะทัะปััะฐัั

### ะะพะฒัะต ะบะพะปะพะฝะบะธ ะฒ DataFrame:

| ะะพะปะพะฝะบะฐ | ะะฟะธัะฐะฝะธะต | ะัะธะผะตั |
|---------|----------|--------|
| `serp_intent` | ะะฝัะตะฝั ะฟะพ SERP offer_info | `informational` |
| `serp_confidence` | ะฃะฒะตัะตะฝะฝะพััั (0-1) | `0.85` |
| `serp_docs_with_offers` | ะะพะบัะผะตะฝัะพะฒ ั offer_info | `0` |
| `serp_total_docs` | ะัะตะณะพ ะฟัะพะฐะฝะฐะปะธะทะธัะพะฒะฐะฝะพ | `20` |
| `serp_offer_ratio` | ะะพะปั ั offer_info | `0.0` |
| `main_intent` | **ะคะะะะะฌะะซะ ะธะฝัะตะฝั** | `informational` |

---

## ๐ฏ ะัะธะผะตัั ะบะปะฐััะธัะธะบะฐัะธะธ

### ะัะธะผะตั 1: ะขะตัะฝะธัะตัะบะฐั ะดะพะบัะผะตะฝัะฐัะธั โ

```xml
ะะฐะฟัะพั: "ัะท ัะบัะด ะฑะพะปะธะด"
XML ะฒัะดะฐัะฐ:
<group>
  <doc>
    <url>https://protek.ru/.../tz_po_sistemam_bezopasnosti.docx</url>
    <title>ะขะะฅะะะงะะกะะะ ะะะะะะะ ะฝะฐ ัะฐะทัะฐะฑะพัะบั...</title>
    <!-- ะะะข <offer_info> -->
  </doc>
</group>
...

ะะตะทัะปััะฐั:
- docs_with_offers: 0/20
- ratio: 0.0 < 0.4
โ informational โ
```

### ะัะธะผะตั 2: ะะพะผะผะตััะตัะบะธะน ะทะฐะฟัะพั โ

```xml
ะะฐะฟัะพั: "ะบัะฟะธัั ัะบัะด"
XML ะฒัะดะฐัะฐ:
<group>
  <doc>
    <url>https://market.yandex.ru/...</url>
    <title>ะัะฟะธัั ะกะะฃะ ะฒ ะะพัะบะฒะต</title>
    <offer_info>
      <price>45000</price>
      ...
    </offer_info>
  </doc>
</group>
...

ะะตะทัะปััะฐั:
- docs_with_offers: 15/20
- ratio: 0.75 >= 0.4
โ commercial โ
```

### ะัะธะผะตั 3: ะกะผะตัะฐะฝะฝะฐั ะฒัะดะฐัะฐ (ะธะฝัะพัะผะฐัะธะพะฝะฝัะน ั ัะตะบะปะฐะผะพะน)

```xml
ะะฐะฟัะพั: "ะพัะทัะฒั ัะบัะด"
XML ะฒัะดะฐัะฐ:
- ะะพะบัะผะตะฝัั 1-15: ัะพััะผั, ะพัะทะพะฒะธะบะธ (ะฑะตะท offer_info)
- ะะพะบัะผะตะฝัั 16-20: ะผะฐะณะฐะทะธะฝั (ั offer_info)

ะะตะทัะปััะฐั:
- docs_with_offers: 5/20
- ratio: 0.25 < 0.4
โ informational โ (ะฟัะตะพะฑะปะฐะดะฐัั ะพัะทัะฒั)
```

---

## ๐ ะะฐะฟััะบ

```bash
python main.py
```

ะะปะฐััะธัะธะบะฐัะธั ะฟะพ SERP offer_info **ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฐะบัะธะฒะธััะตััั**, ะตัะปะธ:
1. โ ะััั SERP ะดะฐะฝะฝัะต ะฒ ะฑะฐะทะต (`output/serp_data.db`)
2. โ XML ะพัะฒะตัั ะทะฐะณััะถะตะฝั ะฒ DataFrame (`xml_response` ะบะพะปะพะฝะบะฐ)

---

## ๐ ะกัะฐัะธััะธะบะฐ ะฒ ะฟัะพัะตััะต

```
๐ท๏ธ  ะญะขะะ 6: ะะปะฐััะธัะธะบะฐัะธั (ั ััะตัะพะผ SERP + ะบะปะฐััะตัะพะฒ)
--------------------------------------------------------------------------------
๐ ะะปะฐััะธัะธะบะฐัะธั ะธะฝัะตะฝัะฐ...
โ ะะฝัะตะฝั ะบะปะฐััะธัะธัะธัะพะฒะฐะฝ

๐ ะะพััะตะบัะธัะพะฒะบะฐ ะธะฝัะตะฝัะฐ ะฟะพ SERP offer_info...
โ ะะฝัะตะฝั ัะบะพััะตะบัะธัะพะฒะฐะฝ ะฟะพ SERP offer_info (ะธะทะผะตะฝะตะฝะพ: 234 ะธะท 5292)
  ๐ ะกัะตะดะฝัั ะดะพะปั ะดะพะบัะผะตะฝัะพะฒ ั offer_info: 12.3%
```

---

## โ ะัะตะธะผััะตััะฒะฐ ะฝะพะฒะพะณะพ ะฟะพะดัะพะดะฐ

| ะัะธัะตัะธะน | ะกัะฐััะน (ะดะพะผะตะฝั) | **ะะพะฒัะน (SERP offer_info)** |
|----------|-----------------|------------------------------|
| ะขะพัะฝะพััั | โ 70-80% | โ **95%+** |
| ะฃัะธััะฒะฐะตั ะทะฐะฟัะพั | โ ะะตั | โ **ะะฐ** |
| ะฃัะธััะฒะฐะตั ะบะพะฝัะตะบัั | โ ะะตั | โ **ะะฐ** |
| ะะฑัะตะบัะธะฒะฝะพััั | โ๏ธ ะกัะตะดะฝัั | โ **ะััะพะบะฐั** |
| ะกะบะพัะพััั | โ ะััััะพ | โ ะััััะพ |

---

## ๐ฌ ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ

### ะงัะพ ัะฐะบะพะต `<offer_info>`?

```xml
<offer_info>
  <price>45000</price>
  <currency>RUB</currency>
  <shop_rating>4.8</shop_rating>
  <shop_reviews>125</shop_reviews>
</offer_info>
```

**ะฏะฝะดะตะบั ะดะพะฑะฐะฒะปัะตั `<offer_info>` ัะพะปัะบะพ ะดะปั ะดะพะบัะผะตะฝัะพะฒ ั ัะพะฒะฐัะฝัะผะธ ะฟัะตะดะปะพะถะตะฝะธัะผะธ!**

ะญัะพ ะพะทะฝะฐัะฐะตั:
- โ ะะฝัะตัะฝะตั-ะผะฐะณะฐะทะธะฝั ั ัะตะฝะฐะผะธ
- โ ะะฐััะพัะบะธ ัะพะฒะฐัะพะฒ ะฝะฐ ะผะฐัะบะตัะฟะปะตะนัะฐั
- โ ะะพะผะผะตััะตัะบะธะต ะปะตะฝะดะธะฝะณะธ ั ะฟัะฐะนัะพะผ
- โ ะกัะฐััะธ, ัะพััะผั, ะฑะปะพะณะธ
- โ ะขะตัะฝะธัะตัะบะฐั ะดะพะบัะผะตะฝัะฐัะธั
- โ ะะฝัะพัะผะฐัะธะพะฝะฝัะต ัะตััััั

---

## ๐ก ะัะพะณ

**ะะปะฐััะธัะธะบะฐัะธั ะฟะพ SERP offer_info โ ัะฐะผัะน ัะพัะฝัะน ัะฟะพัะพะฑ ะพะฟัะตะดะตะปะตะฝะธั ะธะฝัะตะฝัะฐ!**

โ ะกะผะพััะธะผ ะฝะฐ ะะะะะฌะะฃะฎ ะฒัะดะฐัั ะดะปั ะะะะะะะ ะทะฐะฟัะพัะฐ  
โ ะฃัะธััะฒะฐะตะผ ะะะะขะะะกะข (ััะพ ะฟะพะบะฐะทัะฒะฐะตั ะฏะฝะดะตะบั)  
โ ะะฑัะตะบัะธะฒะฝะพ (ะฝะต ัะณะฐะดัะฒะฐะตะผ ะฟะพ ัะปะพะฒะฐะผ)  
โ ะััััะพ (ะดะฐะฝะฝัะต ัะถะต ะฒ ะฑะฐะทะต ะฟะพัะปะต SERP ะฐะฝะฐะปะธะทะฐ)  

---

**ะะฐัะฐ:** 7 ะดะตะบะฐะฑัั 2025  
**ะะตััะธั:** 4.0 - ะบะปะฐััะธัะธะบะฐัะธั ะฟะพ SERP offer_info  
**ะคะฐะนะปั:**
- `seo_analyzer/classification/intent/serp_offer_classifier.py` (ะฝะพะฒัะน)
- `pipeline/stages/classifier.py` (ะพะฑะฝะพะฒะปะตะฝ)
- `pipeline/stages/serp_analyzer.py` (ะดะพะฑะฐะฒะปะตะฝ xml_response ะฒ DataFrame)

