# üöÄ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞

–†–∞–Ω—å—à–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ Natasha NER –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** –≤–æ –≤—Ä–µ–º—è —ç—Ç–∞–ø–∞ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏:

```
–≠–¢–ê–ü 2: –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
   ‚Üì
–≠–¢–ê–ü 3: –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
   ‚Üì  
–≠–¢–ê–ü 4: SERP –∞–Ω–∞–ª–∏–∑
   ‚Üì
–≠–¢–ê–ü 5: –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è ‚Üí üåç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ (–î–û–õ–ì–û!)
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- –ì–µ–æ–≥—Ä–∞—Ñ–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–ª–∞—Å—å —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ (–Ω–∞ —ç—Ç–∞–ø–µ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏)
- –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–Ω–∏–º–∞–ª –≤—Ä–µ–º—è –Ω–∞ —ç—Ç–∞–ø–µ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
- –ú–µ–∂–¥—É –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π –∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–µ–π –ø—Ä–æ—Ö–æ–¥–∏—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è, SERP –∞–Ω–∞–ª–∏–∑)
- –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–æ—Å—å —ç—Ç–æ "—Å–≤–æ–±–æ–¥–Ω–æ–µ" –≤—Ä–µ–º—è –¥–ª—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

## –†–µ—à–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ —Ñ–æ–Ω–µ** —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:

```
–≠–¢–ê–ü 2: –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚Üí –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
   ‚Üì                        ‚Üì
   ‚Üì                    üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è (–§–û–ù–û–í–ê–Ø!)
   ‚Üì                        ‚Üì
–≠–¢–ê–ü 3: –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è       ‚Üì
   ‚Üì                        ‚Üì
–≠–¢–ê–ü 4: SERP –∞–Ω–∞–ª–∏–∑         ‚Üì
   ‚Üì                        ‚Üì
–≠–¢–ê–ü 5: –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è ‚Üê ‚úÖ –ì–µ–æ–≥—Ä–∞—Ñ–∏—è –≥–æ—Ç–æ–≤–∞!
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ì–µ–æ–≥—Ä–∞—Ñ–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** —Å –¥—Ä—É–≥–∏–º–∏ —ç—Ç–∞–ø–∞–º–∏
- ‚úÖ –ö –º–æ–º–µ–Ω—Ç—É –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã **—É–∂–µ –≥–æ—Ç–æ–≤—ã**
- ‚úÖ –ù–µ—Ç –æ–∂–∏–¥–∞–Ω–∏—è –Ω–∞ —ç—Ç–∞–ø–µ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è **—Å–æ–∫—Ä–∞—â–∞–µ—Ç—Å—è**

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. AsyncGeoProcessor

–ù–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏:

```python
# seo_analyzer/clustering/geo_processor.py
class AsyncGeoProcessor:
    """
    –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.
    
    –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏, —á—Ç–æ–±—ã –∫ –º–æ–º–µ–Ω—Ç—É 
    –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–∂–µ –±—ã–ª–∏ –≥–æ—Ç–æ–≤—ã.
    """
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 4)
- –ë–∞—Ç—á–∏–Ω–≥ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (`is_ready()`)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (`get_result()`)

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ preprocessor

–í `pipeline/stages/preprocessor.py` –ø–æ—Å–ª–µ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:

```python
# üåç –ó–ê–ü–£–°–ö–ê–ï–ú –ê–°–ò–ù–•–†–û–ù–ù–£–Æ –û–ë–†–ê–ë–û–¢–ö–£ –ì–ï–û–ì–†–ê–§–ò–ò –í –§–û–ù–ï
print_stage(analyzer, "\nüåç –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ...")

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º semantic_checker –µ—Å–ª–∏ –æ–Ω –Ω—É–∂–µ–Ω –¥–ª—è –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏
from seo_analyzer.clustering.semantic_checker import SemanticClusterChecker
semantic_checker = SemanticClusterChecker(geo_dicts=analyzer.geo_dicts)

# –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É
analyzer.geo_processor = AsyncGeoProcessor(
    semantic_checker=semantic_checker,
    max_workers=4
)

queries_list = analyzer.df['keyword'].tolist()
analyzer.geo_processor.start_processing(queries_list)

print_stage(analyzer, "‚úì –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –¥—Ä—É–≥–∏–º–∏ —ç—Ç–∞–ø–∞–º–∏)")
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏

–í `seo_analyzer/clustering/serp_advanced_clusterer.py`:

```python
def cluster_by_serp(
    self, 
    df: pd.DataFrame, 
    serp_column: str = 'serp_main_pages',
    geo_processor=None  # ‚Üê –ù–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä!
) -> pd.DataFrame:
    
    if geo_processor is not None:
        # –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        print("üåç –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏...")
        
        if geo_processor.is_ready():
            print("‚úì –ì–µ–æ–≥—Ä–∞—Ñ–∏—è —É–∂–µ –≥–æ—Ç–æ–≤–∞ (–æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ)!")
        else:
            print("‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏...")
        
        # –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (–∂–¥–µ–º –µ—Å–ª–∏ –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤—ã)
        geo_result = await geo_processor.get_result()
        
        query_geo_dict = geo_result.query_geo_dict
        geo_groups = geo_result.geo_groups
    else:
        # FALLBACK: –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–µ–æ–≥—Ä–∞—Ñ–∏—é —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±)
        # ...
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç –Ω–∞ 1300 –∑–∞–ø—Ä–æ—Å–∞—Ö:

```
üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´
‚è±Ô∏è  –û–±—â–µ–µ –≤—Ä–µ–º—è: 3.03—Å
‚ö° –°–∫–æ—Ä–æ—Å—Ç—å: 429 –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫

üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤: 5
üìç –ó–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏: 5

üèÜ –¢–æ–ø-5 –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤:
  ‚Ä¢ –º–æ—Å–∫–≤–∞: 3 –∑–∞–ø—Ä–æ—Å–æ–≤
  ‚Ä¢ —Å–∞–Ω–∫—Ç-–ø–µ—Ç–µ—Ä–±—É—Ä–≥: 2 –∑–∞–ø—Ä–æ—Å–æ–≤
  ‚Ä¢ –∫–∞–∑–∞–Ω—å: 1 –∑–∞–ø—Ä–æ—Å–æ–≤
  ‚Ä¢ –∫—Ä–∞—Å–Ω–æ–¥–∞—Ä: 1 –∑–∞–ø—Ä–æ—Å–æ–≤
  ‚Ä¢ –Ω–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫: 1 –∑–∞–ø—Ä–æ—Å–æ–≤

‚úÖ –ì–µ–æ–≥—Ä–∞—Ñ–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –†–ê–ù–¨–®–ï —á–µ–º –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –¥—Ä—É–≥–∞—è —Ä–∞–±–æ—Ç–∞
```

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:** –ì–µ–æ–≥—Ä–∞—Ñ–∏—è –±—ã–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** —Å –∏–º–∏—Ç–∞—Ü–∏–µ–π –¥—Ä—É–≥–æ–π —Ä–∞–±–æ—Ç—ã (3 —Å–µ–∫—É–Ω–¥—ã), –∏ –∫ –º–æ–º–µ–Ω—Ç—É –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–∂–µ –±—ã–ª–∏ –≥–æ—Ç–æ–≤—ã.

---

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ï—Å–ª–∏ `geo_processor` –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω –≤ `cluster_by_serp()`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥:

```python
if geo_processor is not None:
    # –ù–æ–≤—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–±
    ...
else:
    # FALLBACK: –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–µ–æ–≥—Ä–∞—Ñ–∏—é —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ (—Å—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±)
    for query in queries_with_serp:
        geo = self.semantic_checker.extract_geo(query)
        query_geo_dict[query] = geo
```

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

---

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –†–∞–Ω—å—à–µ (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ):
```
–í—Ä–µ–º—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:     1 —Å–µ–∫
–í—Ä–µ–º—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏:   10 —Å–µ–∫
–í—Ä–µ–º—è SERP –∞–Ω–∞–ª–∏–∑–∞:    30 —Å–µ–∫
–í—Ä–µ–º—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏:   20 —Å–µ–∫ (–≤–∫–ª—é—á–∞—è 5 —Å–µ–∫ –Ω–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏—é)
-------------------------------------------
–ò–¢–û–ì–û:                 61 —Å–µ–∫
```

### –¢–µ–ø–µ—Ä—å (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ):
```
–í—Ä–µ–º—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:     1 —Å–µ–∫
  ‚îî‚Üí –ì–µ–æ–≥—Ä–∞—Ñ–∏—è (—Ñ–æ–Ω):   5 —Å–µ–∫ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ!)
–í—Ä–µ–º—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏:   10 —Å–µ–∫
–í—Ä–µ–º—è SERP –∞–Ω–∞–ª–∏–∑–∞:    30 —Å–µ–∫
–í—Ä–µ–º—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏:   15 —Å–µ–∫ (–≥–µ–æ–≥—Ä–∞—Ñ–∏—è —É–∂–µ –≥–æ—Ç–æ–≤–∞!)
-------------------------------------------
–ò–¢–û–ì–û:                 56 —Å–µ–∫ (-5 —Å–µ–∫, -8%)
```

**–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏:** –î–æ 8% –Ω–∞ –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–∞—Ö –¥–∞–Ω–Ω—ã—Ö!

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ù–∏–∫–∞–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

```bash
python main.py --input-file semantika/queries.csv
```

–ì–µ–æ–≥—Ä–∞—Ñ–∏—è –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –≤ —Ñ–æ–Ω–µ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫.

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è

AsyncGeoProcessor —Ä–∞–∑–±–∏–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –±–∞—Ç—á–∏ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:

```python
# –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –±–∞—Ç—á–∏ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
batch_size = max(100, len(queries) // max_workers)
batches = [
    queries[i:i + batch_size] 
    for i in range(0, len(queries), batch_size)
]

# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±–∞—Ç—á–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –≤ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö
with ThreadPoolExecutor(max_workers=self.max_workers) as executor:
    batch_tasks = [
        loop.run_in_executor(executor, self._process_batch, batch)
        for batch in batches
    ]
    batch_results = await asyncio.gather(*batch_tasks)
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏

`GeoProcessingResult` —Å–æ–¥–µ—Ä–∂–∏—Ç:
- `query_geo_dict`: –°–ª–æ–≤–∞—Ä—å {query: geo}
- `geo_groups`: –°–ª–æ–≤–∞—Ä—å {geo: [queries]}
- `geo_stats`: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–≥–º–µ–Ω—Ç–æ–≤, –∑–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ –≥–µ–æ)

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ - —ç—Ç–æ –ø—Ä–∏–º–µ—Ä **—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è**. 

–í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≥–µ–æ–≥—Ä–∞—Ñ–∏—é —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω–∞ –Ω—É–∂–Ω–∞, –º—ã –∑–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∑–∞—Ä–∞–Ω–µ–µ –≤ —Ñ–æ–Ω–µ, –∏ –∫ –º–æ–º–µ–Ω—Ç—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–∂–µ –≥–æ—Ç–æ–≤—ã.

–≠—Ç–æ —Å–æ–∫—Ä–∞—â–∞–µ—Ç –æ–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –¥–µ–ª–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –±–æ–ª–µ–µ –æ—Ç–∑—ã–≤—á–∏–≤—ã–º.

